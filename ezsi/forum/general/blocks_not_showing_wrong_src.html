<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">



<!-- Mirrored from projects.ez.no/ezsi/forum/general/blocks_not_showing_wrong_src by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 05 Feb 2017 12:40:13 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>                                                                                
<title>
            Blocks not showing - wrong src?     /         General     /         Forum        
</title>

<meta http-equiv="Content-Language" content="en-GB" />
    <meta name="author" content="eZ Systems" />
    <meta name="copyright" content="eZ Systems" />
    <meta name="description" content="Content Management System" />
    <meta name="keywords" content="cms, publish, e-commerce, content management, development framework" />

<meta name="MSSmartTagsPreventParsing" content="TRUE" />
<meta name="generator" content="eZ Publish" />

<style type="text/css">
    @import url(../../../extension/ezprojects2007/design/ezprojects2007/stylesheets/core.css);
    @import url(../../../extension/ezprojects2007/design/ezprojects2007/stylesheets/pagelayout.css);
    @import url(../../../extension/ezprojects2007/design/ezprojects2007/stylesheets/classes.css);
    @import url(../../../extension/ezprojects2007/design/ezprojects2007/stylesheets/print.css) print;
</style>

<link type="text/css" rel="stylesheet" href="../../../extension/ezprojects2007/design/ezprojects2007/stylesheets/print.css" media="print" />

<!-- IE conditional comments; for bug fixes for different IE versions -->
<!--[if IE 5]>     <style type="text/css"> @import url(/extension/ezprojects2007/design/ezprojects2007/stylesheets/ie5.css);    </style> <![endif]-->
<!--[if lte IE 6]> <style type="text/css"> @import url(/extension/ezprojects2007/design/ezprojects2007/stylesheets/ie6lte.css); </style> <![endif]-->
<!--[if IE 6]>     <style type="text/css"> @import url(/extension/ezprojects2007/design/ezprojects2007/stylesheets/ie6.css);    </style> <![endif]-->

<!-- Load special stylesheet (if necessary) for newer Netscape decendants, Mozilla and Firefox, using the Gecko renderer -->
<script type="text/javascript"><!-- if ((navigator.userAgent.indexOf("Gecko") != -1)&&(navigator.userAgent.indexOf("KHTML") == -1)) document.write("<style type=\"text/css\">@import url(/extension/ezprojects2007/design/ezprojects2007/stylesheets/gecko.css);</style>");--></script>

<script type="text/javascript" src="../../../extension/ezprojects2007/design/ezprojects2007/javascripts/switch-width.js"></script>

<script type="text/javascript" src="../../../extension/ezprojects2007/design/ezprojects2007/javascripts/dropdownmenu.js"></script>
<script type="text/javascript" src="../../../extension/ezprojects2007/design/ezprojects2007/javascripts/insertmedia.js"></script>
<script type="text/javascript" src="../../../extension/ezprojects2007/design/ezprojects2007/javascripts/link-target.js"></script>

<script type="text/javascript" src="../../../var/plain_site/cache/public/javascript/059cd8e3b9fa455a526077cbccc48048.js" charset="utf-8"></script>


</head>
<body onload="menuInit();">

<!-- Complete page area: START -->
<div id="page">

<!-- Header area: START -->
<div id="header">
<div id="header-insert">

<!-- User menu area: START -->
<div id="usermenu">

<div id="page-width1">

<div id="logo">
<h1><a href="../../../index.html"><span class="hide">eZ Systems</span></a></h1>
</div>

<h2 id="slogan">Share your information</h2>

<p class="hide"><a href="#main">Skip to main content</a></p>

<hr class="hide" />
<div id="searchbox">
<form action="http://projects.ez.no/content/advancedsearch" method="get">

<div class="block">
<div class="element">
<input id="searchbutton" class="button" type="submit" value="Search" />
</div>

<div class="element searchstring">
    <label for="searchtext" class="hide">Search text:</label>
    <input id="searchtext" name="SearchText" type="text" size="12" />
    

    </div>

</div>
</form>
</div>

<hr class="hide" />
<h2 class="hide">User menu</h2>

<!-- User menu content: START -->
<ul>
            <li><a href="http://login.ez.no/register?return=http://projects.ez.no/ezpsectioncontentreport">Become a member of the eZ Community</a></li>
        <li><a href="http://login.ez.no/forgotpassword?return=http://projects.ez.no/ezdebug_template_operator">Lost password?</a></li>
    
    <li>
    
    <script type="text/javascript">
    <!--
    if ( fixedSize )
    {
        document.write('<a id="setwidth" href="#" onclick="setWidth(); return false;">Dynamic width</a>');
    }
    else
    {
        document.write('<a id="setwidth" href="#" onclick="setWidth(); return false;">Fixed width</a>');
    }
    -->
    </script>
    
    </li>
    
            <li><a href="http://login.ez.no/login?return=http://projects.ez.no/payment">Log in</a></li>
    </ul>
<!-- User menu content: END -->

</div>

</div>
<!-- User menu area: END -->

</div>
</div>
<!-- Header area: END -->

                    
<script type="text/javascript">
<!--
var menu = new Array();

menu[0] = [];
menu[1] = [];
menu[2] = [];
menu[3] = ['General', '/ezsi/forum/general'];
menu[4] = ['Leaders', '/ezsi/team/leaders', 'Members', '/ezsi/team/members'];
menu[5] = [];
menu[6] = [];
menu[7] = [];

-->
</script>
<div id="menuborder">

<!-- Main menu area: START -->
<div id="menu" onmouseover="menuHover();" onmouseout="tryHideSubMenues();">

<div id="mainmenu" class="float-break">
<div id="page-width2">
    <ul id="mainmenulist" class="float-break">

    <li class="project" ><a href="../../../ezsi.html" onmouseover="switchSubMenu( this );">eZSI &nbsp;&nbsp;&gt;&gt;</a></li>
                        <li ><a href="../../news.html" onmouseover="switchSubMenu( this );">News</a></li>
                            <li ><a href="../../downloads.html" onmouseover="switchSubMenu( this );">Downloads</a></li>
                            <li class="current"><a href="../../forum.html" onmouseover="switchSubMenu( this );">Forum</a></li>
                            <li ><a href="../../team.html" onmouseover="switchSubMenu( this );">Team</a></li>
                            <li ><a href="../../subversion.html" onmouseover="switchSubMenu( this );">Source</a></li>
                            <li ><a href="../../gallery.html" onmouseover="switchSubMenu( this );">Gallery</a></li>
                            <li class="last"><a href="../../reviews.html" onmouseover="switchSubMenu( this );">Reviews</a></li>
        
    </ul>

</div>
</div>


<div id="submenu">
<div id="page-width3">
    <ul class="float-break">

                    
            
    <li class="last current"><a href="../general.html">General</a></li>

        

</ul>
</div>
</div>

<script type="text/javascript"><!--
document.getElementById('submenu').style.display = 'none';
--></script>

</div>
<!-- Main menu area: END -->

</div>

<hr class="hide" />
<!-- Path area: START -->
<div id="path">

<div id="page-width4">
<h2 class="hide">Path</h2>

<!-- Path content: START -->
<p>
                                    <a href="../../../content/view/full/2.html">ez projects</a>
                    
                        /
                            <a href="../../../ezsi.html">ezsi</a>
        
                        /
                            <a href="../../forum.html">forum</a>
        
                        /
                            <a href="../general.html">general</a>
        
                        /
                                        blocks not showing - wrong...
                    
            </p>
<!-- Path content: END -->

</div>

</div>
<!-- Path area: END -->

<hr class="hide" />

<!-- Main area: START -->

<div id="page-width5">
<div id="main" class="float-break">

<!-- Main area content: START -->




<div class="template-design area-main-full">
<div class="template-module content-view-full">
<div class="template-object class-forummessage">



<div id="top" class="attribute-heading">
    <h1>Blocks not showing - wrong src?</h1>
</div>


    <p>You need to be <a href="http://login.ez.no/login?return=http://projects.ez.no/payment">logged in</a> to post messages in the forums. New users may <a href="http://auth.ez.no/user/register">register here</a>.</p>


 



<div class="content-view-children">

<table class="forum list" cellspacing="0">

    




<tr class="bglight" id="msg15990">
    
    <td class="info">
        <p class="author"><a href="../../../users/community/andreas_kaiser.html">Andreas Kaiser</a></p>


                    <div class="attribute-image">

    
        
    
    <img src="../../../var/plain_site/storage/images/users/community/andreas_kaiser/11493-2-eng-GB/andreas_kaiser_small.jpg" width="96" height="96"  border="0" alt="" title="" />
    
    
    </div>
        
        <p class="membersince">Member since:<br />09 January 2008</p>
        <p class="posts">Posts: 9</p>
    </td>

    
    <td class="message">
                    <form method="post" action="http://projects.ez.no/content/action">
                <div class="object-right">
                                                </div>
           </form>
       
        <p class="date">Tuesday 28 April 2009 7:12:54 pm</p>

        <div class="attribute-long">Thanks for the great extension,<br />
<br />
just trying to make it work with one project (with varnish). In this project I have one webserver with ez publish and a separate varnish server.<br />
<br />
First the var/si-blocks/---.html files are being created ok.<br />
<br />
The main problem is that the blocks are not being showed, perhaps because the src includes is like:<br />
<br />
<pre class="wordwrap"><span class="line"></span>

<span class="line">&lt;esi:include src=&quot;var/si-blocks/dcfd8220424368a90edf6f8b56e9fe61.htm&quot; ttl=&quot;1m&quot; onerror=&quot;continue&quot;/&gt;</span>

<span class="line"></span></pre><br />
<br />
Shouldn't it include the domain I have configured in ezsi.ini.append.php?:<br />
<br />
<pre class="wordwrap"><span class="line"></span>

<span class="line">BlockFilePathPrependString=<a href="http://www.example.com/" title="http://www.example.com/">http://www.example.com/</a></span>

<span class="line"></span></pre><br />
<br />
Also tried with other configurations like &quot;<a href="http://www.example.com/var/si-blocks/"" title="http://www.example.com/var/si-blocks/&quot;">http://www.example.com/var/si-blocks/&quot;</a><br />
<br />
Anyway when I disable &quot;ActivateSIMarkup&quot; all works (I assume because it loads ez publish template instead of created html files...)<br />
<br />
Perhaps this could be related with varnish... but I really don't see how the &quot;BlockFilePathPrependString&quot; settings affect the esi includes...
</div>
                    <div class="attribute-signature">
            <p>eZ Partner in Madrid (Spain)<br />
Web: <a href="http://www.atela.net/" title="http://www.atela.net/">http://www.atela.net/</a></p>
            </div>
        
                                </td>
    <td class="buttons">
    <div class="button">
        <a href="#main"><img src="../../../extension/ezprojects2007/design/ezprojects2007/images/button-move_up.gif" height="16" width="16" alt="Up" title="Jump to first message" /></a>
    </div>
    </td>
</tr>
    




<tr class="bgdark" id="msg15991">
    
    <td class="info">
        <p class="author"><a href="../../../users/community/jerome_renard.html">Jérôme Renard</a></p>


                    <div class="attribute-image">

    
        
    
    <img src="../../../var/plain_site/storage/images/users/community/jerome_renard/49352-5-eng-GB/jerome_renard_small.png" width="100" height="62"  border="0" alt="" title="" />
    
    
    </div>
        
        <p class="membersince">Member since:<br />06 August 2008</p>
        <p class="posts">Posts: 22</p>
    </td>

    
    <td class="message">
                    <form method="post" action="http://projects.ez.no/content/action">
                <div class="object-right">
                                                </div>
           </form>
       
        <p class="date">Tuesday 28 April 2009 8:00:33 pm</p>

        <div class="attribute-long">Hi Andreas,<br />
<pre class="wordwrap"><span class="line"></span>

<span class="line">The main problem is that the blocks are not being showed, perhaps because the src includes is like:</span>

<span class="line">&nbsp;</span>

<span class="line">&lt;esi:include src=&quot;var/si-blocks/dcfd8220424368a90edf6f8b56e9fe61.htm&quot; ttl=&quot;1m&quot; onerror=&quot;continue&quot;/&gt;</span>

<span class="line">&nbsp;</span>

<span class="line">Shouldn't it include the domain I have configured in ezsi.ini.append.php?:</span>

<span class="line">&nbsp;</span>

<span class="line">BlockFilePathPrependString=<a href="http://www.example.com/" title="http://www.example.com/">http://www.example.com/</a></span>

<span class="line"></span></pre><br />
No, basically, BlockFilePathPreprendString is only used when FileHandler=FTP.<br />
Basically it is here to make it possible to use ESI with Akamai and to upload SI blocks on a specific Akamais's FTP server.<br />
<br />
<pre class="wordwrap"><span class="line"></span>

<span class="line">Also tried with other configurations like &quot;<a href="http://www.example.com/var/si-blocks/"" title="http://www.example.com/var/si-blocks/&quot;">http://www.example.com/var/si-blocks/&quot;</a></span>

<span class="line"></span></pre><br />
You should leave BlockFilePathPrependString empty, like this<br />
<pre class="wordwrap"><span class="line"></span>

<span class="line">BlockFilePathPrependString=</span>

<span class="line"></span></pre><br />
<br />
<pre class="wordwrap"><span class="line"></span>

<span class="line">Anyway when I disable &quot;ActivateSIMarkup&quot; all works (I assume because it loads ez publish template instead of created html files...)</span>

<span class="line"></span></pre><br />
Yes.<br />
<br />
If ever you want to test, you can also use the SSI driver (BlockHandler=SSI) and let Apache's mod_include fetch si-blocks, it could be useful for testing, the needed configuration is described in the documentation file, in the following directory :<pre class="wordwrap"><span class="line">extension/ezsi/doc/</span></pre><br />
<br />
Best Regards.
</div>
                    <div class="attribute-signature">
            <p><a href="http://jrenard.info/" title="http://jrenard.info">http://jrenard.info</a> | <a href="http://39web.fr/" title="http://39web.fr">http://39web.fr</a></p>
            </div>
        
                                </td>
    <td class="buttons">
    <div class="button">
        <a href="#main"><img src="../../../extension/ezprojects2007/design/ezprojects2007/images/button-move_up.gif" height="16" width="16" alt="Up" title="Jump to first message" /></a>
    </div>
    </td>
</tr>    




<tr class="bglight" id="msg15992">
    
    <td class="info">
        <p class="author"><a href="../../../users/community/andreas_kaiser.html">Andreas Kaiser</a></p>


                    <div class="attribute-image">

    
        
    
    <img src="../../../var/plain_site/storage/images/users/community/andreas_kaiser/11493-2-eng-GB/andreas_kaiser_small.jpg" width="96" height="96"  border="0" alt="" title="" />
    
    
    </div>
        
        <p class="membersince">Member since:<br />09 January 2008</p>
        <p class="posts">Posts: 9</p>
    </td>

    
    <td class="message">
                    <form method="post" action="http://projects.ez.no/content/action">
                <div class="object-right">
                                                </div>
           </form>
       
        <p class="date">Tuesday 28 April 2009 8:21:02 pm</p>

        <div class="attribute-long">Thanks Jérôme for the fast answer... Now I really now how to proceed with my project...
</div>
                    <div class="attribute-signature">
            <p>eZ Partner in Madrid (Spain)<br />
Web: <a href="http://www.atela.net/" title="http://www.atela.net/">http://www.atela.net/</a></p>
            </div>
        
                                </td>
    <td class="buttons">
    <div class="button">
        <a href="#main"><img src="../../../extension/ezprojects2007/design/ezprojects2007/images/button-move_up.gif" height="16" width="16" alt="Up" title="Jump to first message" /></a>
    </div>
    </td>
</tr>    




<tr class="bgdark" id="msg22095">
    
    <td class="info">
        <p class="author"><a href="../../../users/community/pablo_pernot.html">Pablo Pernot</a></p>


                    <div class="attribute-image">

    
        
    
    <img src="../../../var/plain_site/storage/images/users/community/pablo_pernot/17028-19-eng-GB/pablo_pernot_small.png" width="99" height="100"  border="0" alt="" title="" />
    
    
    </div>
        
        <p class="membersince">Member since:<br />09 January 2008</p>
        <p class="posts">Posts: 17</p>
    </td>

    
    <td class="message">
                    <form method="post" action="http://projects.ez.no/content/action">
                <div class="object-right">
                                                </div>
           </form>
       
        <p class="date">Wednesday 06 January 2010 4:46:33 pm</p>

        <div class="attribute-long">Hello Jérome. (salut !) <br />
<br />
same question.<br />
with the esi mode I generate a link which can't work var/si-blocks... as it is relative. <br />
<br />
If -has indicated below- I use the SSI mode, ok it works, but I miss a step : where is varnish ? Ok the EZSI store the content, generate the static html file, and add the include in the html view, so apache mode_filter &amp; mod_include  include the html file (which has a right ./var/site-blocks... url). <br />
<br />
So I obviously miss a step : where is varnish there ? <br />
If I switched back to ESI Mode =&gt; varnish. <br />
The link to the var/si-block won't work anymore. <br />
What are the rules to put in the varnish vcl config ? <br />
<br />
I noticed here : <br />
<a href="http://varnish.projects.linpro.no/wiki/ESIfeatures" title="http://varnish.projects.linpro.no/wiki/ESIfeatures">http://varnish.projects.linpro.no/wiki/ESIfeatures</a><br />
sub vcl_fetch {<br />
    if (req.url == &quot;/test.html&quot;) {<br />
        esi;  /* Do ESI processing */<br />
        set obj.ttl = 24 h;<br />
    } elseif (req.url == &quot;/cgi-bin/date.cgi&quot;) {<br />
        set obj.ttl = 1m;<br />
    }<br />
}<br />
<br />
Ok I understand well that Varnish should only get the date.cgi but in our case the url is not working (again a relative url var/si-blocks). BTW I'm using URI siteaccess. <br />
Thanks for you help, I'd like to quickly validate the Varnish / ESI team. <br />
Thanks for your extension. <br />
<br />
 
</div>
                    <div class="attribute-signature">
            <p>Pablo Pernot<br />
<a href="http://www.smartview.fr/" title="http://www.smartview.fr">http://www.smartview.fr</a><br />
<a href="http://www.areyouagile.com/" title="http://www.areyouagile.com">http://www.areyouagile.com</a></p>
            </div>
        
                                </td>
    <td class="buttons">
    <div class="button">
        <a href="#main"><img src="../../../extension/ezprojects2007/design/ezprojects2007/images/button-move_up.gif" height="16" width="16" alt="Up" title="Jump to first message" /></a>
    </div>
    </td>
</tr>    




<tr class="bglight" id="msg22220">
    
    <td class="info">
        <p class="author"><a href="../../../users/community/jerome_renard.html">Jérôme Renard</a></p>


                    <div class="attribute-image">

    
        
    
    <img src="../../../var/plain_site/storage/images/users/community/jerome_renard/49352-5-eng-GB/jerome_renard_small.png" width="100" height="62"  border="0" alt="" title="" />
    
    
    </div>
        
        <p class="membersince">Member since:<br />06 August 2008</p>
        <p class="posts">Posts: 22</p>
    </td>

    
    <td class="message">
                    <form method="post" action="http://projects.ez.no/content/action">
                <div class="object-right">
                                                </div>
           </form>
       
        <p class="date">Tuesday 12 January 2010 1:34:49 pm</p>

        <div class="attribute-long">Hi Pablo,<br />
<br />
not sure I understand your question but I'll try to answer :)<br />
<br />
<pre class="wordwrap"><span class="line"></span>

<span class="line">If -has indicated below- I use the SSI mode, ok it works, but I miss a step : where is varnish ? Ok the EZSI store the content, generate the static html file, and add the include in the html view, so apache mode_filter &amp; mod_include include the html file (which has a right ./var/site-blocks... url).</span>

<span class="line"></span></pre><br />
There is a misunderstanding here. Varnish can not parse SSI tags, but only ESI ones.<br />
The difference between SSI and ESI is (to sum up) the syntax. For example we could use the following SSI code to include a file:<br />
<pre class="wordwrap"><span class="line"></span>

<span class="line">&lt;!--#include file=path/to/file.html --&gt;</span>

<span class="line"></span></pre><br />
<br />
And the following ESI code to do the same thing:<br />
<pre class="wordwrap"><span class="line"></span>

<span class="line">&lt;esi:include src=&quot;path/to/file.html&quot; ttl=&quot;2h&quot; onerror=&quot;continue&quot;/&gt;</span>

<span class="line"></span></pre><br />
<br />
SSI tags can only be parsed by Apache whereas an ESI tag can be parsed by Akamai or Varnish.<br />
<br />
<pre class="wordwrap"><span class="line"></span>

<span class="line">I noticed here :</span>

<span class="line"><a href="http://varnish.projects.linpro.no/wiki/ESIfeatures" title="http://varnish.projects.linpro.no/wiki/ESIfeatures">http://varnish.projects.linpro.no/wiki/ESIfeatures</a></span>

<span class="line">sub vcl_fetch {</span>

<span class="line">if (req.url == &quot;/test.html&quot;) {</span>

<span class="line">esi; /* Do ESI processing */</span>

<span class="line">set obj.ttl = 24 h;</span>

<span class="line">} elseif (req.url == &quot;/cgi-bin/date.cgi&quot;) {</span>

<span class="line">set obj.ttl = 1m;</span>

<span class="line">}</span>

<span class="line">}</span>

<span class="line"></span></pre><br />
<br />
Varnish does not parse the ttl attribute returned by eZSI so you will have to define the TTL by yourself in your VCL file. As explained in the example, if the user requests the /test.html page then the ESI engine will be turned on, an apply any &lt;esi:include&gt; instruction found.<br />
<br />
I do not think it is a problem to have relative path in your ESI src=&quot;&quot; attribute. As long as the file is accessible directly by your browser it should be fetched by Varnish as well. If for example, from your browser you can access <a href="http://example.com/file.html" title="http://example.com/./path/../to/../file.html">http://example.com/./path/../to/../file.html</a><br />
then Varnish should be able to access the file as well.<br />
<br />
If not, check your Apache configuration, either something is misconfigured or a RewriteRule is missing.<br />
<br />
Please also note that using relative path can be a security issue.<br />
<br />
Best Regards.
</div>
                    <div class="attribute-signature">
            <p><a href="http://jrenard.info/" title="http://jrenard.info">http://jrenard.info</a> | <a href="http://39web.fr/" title="http://39web.fr">http://39web.fr</a></p>
            </div>
        
                                </td>
    <td class="buttons">
    <div class="button">
        <a href="#main"><img src="../../../extension/ezprojects2007/design/ezprojects2007/images/button-move_up.gif" height="16" width="16" alt="Up" title="Jump to first message" /></a>
    </div>
    </td>
</tr>    




<tr class="bgdark" id="msg23283">
    
    <td class="info">
        <p class="author"><a href="../../../users/community/valentin_doroschuk.html">Valentin Doroschuk</a></p>


                    <div class="attribute-image">

    
        
    
    <img src="../../../var/plain_site/storage/images/users/community/valentin_doroschuk/27693-3-eng-GB/valentin_doroschuk_small.jpg" width="100" height="100"  border="0" alt="" title="" />
    
    
    </div>
        
        <p class="membersince">Member since:<br />09 January 2008</p>
        <p class="posts">Posts: 3</p>
    </td>

    
    <td class="message">
                    <form method="post" action="http://projects.ez.no/content/action">
                <div class="object-right">
                                                </div>
           </form>
       
        <p class="date">Monday 15 February 2010 3:03:46 pm</p>

        <div class="attribute-long">Hi,<br />
I'm trying to install Varnish and eZSI and could not get it work due to I use MathOrder=uri<br />
and Varnish everytime tries to fetch si blocks using siteaccess<br />
like <a href="http://host.com/siteaccess/var/si-blocks/" title="http://host.com/siteaccess/var/si-blocks/">http://host.com/siteaccess/var/si-blocks/</a>....<br />
<br />
This hack resolves it.<br />
<br />
<pre class="wordwrap"><span class="line"></span>

<span class="line">Index: ezsiblockfunction.php</span>

<span class="line">===================================================================</span>

<span class="line">--- ezsiblockfunction.php&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(revision 54392)</span>

<span class="line">+++ ezsiblockfunction.php&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(working copy)</span>

<span class="line">@@ -107,7 +107,7 @@</span>

<span class="line">&nbsp;</span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if( $SIFileHandler == 'fs' )</span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>

<span class="line">-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$blockFilePathPreprendString = 'var/';</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$blockFilePathPreprendString = '/var/';</span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>

<span class="line">&nbsp;</span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$filePath = $blockFilePathPreprendString . $cacheDir . '/' . $fileName;</span>

<span class="line"></span></pre><br />
<br />
Could you please tip how to configure eZSI or Varnish to get it work without this hack?<br />
Thanks
</div>
        
                                </td>
    <td class="buttons">
    <div class="button">
        <a href="#main"><img src="../../../extension/ezprojects2007/design/ezprojects2007/images/button-move_up.gif" height="16" width="16" alt="Up" title="Jump to first message" /></a>
    </div>
    </td>
</tr>    




<tr class="bglight" id="msg23666">
    
    <td class="info">
        <p class="author"><a href="../../../users/community/pablo_pernot.html">Pablo Pernot</a></p>


                    <div class="attribute-image">

    
        
    
    <img src="../../../var/plain_site/storage/images/users/community/pablo_pernot/17028-19-eng-GB/pablo_pernot_small.png" width="99" height="100"  border="0" alt="" title="" />
    
    
    </div>
        
        <p class="membersince">Member since:<br />09 January 2008</p>
        <p class="posts">Posts: 17</p>
    </td>

    
    <td class="message">
                    <form method="post" action="http://projects.ez.no/content/action">
                <div class="object-right">
                                                </div>
           </form>
       
        <p class="date">Thursday 25 February 2010 7:05:22 pm</p>

        <div class="attribute-long">Thanks Jérome. <br />
<br />
I damned, I copy/paste your doc... please change the &quot;tll&quot; to &quot;ttl&quot; in the example ... ###!:p <br />
there : <br />
{si-block key=string $key [tll=integer $ttl]}
</div>
                    <div class="attribute-signature">
            <p>Pablo Pernot<br />
<a href="http://www.smartview.fr/" title="http://www.smartview.fr">http://www.smartview.fr</a><br />
<a href="http://www.areyouagile.com/" title="http://www.areyouagile.com">http://www.areyouagile.com</a></p>
            </div>
        
                                </td>
    <td class="buttons">
    <div class="button">
        <a href="#main"><img src="../../../extension/ezprojects2007/design/ezprojects2007/images/button-move_up.gif" height="16" width="16" alt="Up" title="Jump to first message" /></a>
    </div>
    </td>
</tr>    




<tr class="bgdark" id="msg24068">
    
    <td class="info">
        <p class="author"><a href="../../../users/community/pablo_pernot.html">Pablo Pernot</a></p>


                    <div class="attribute-image">

    
        
    
    <img src="../../../var/plain_site/storage/images/users/community/pablo_pernot/17028-19-eng-GB/pablo_pernot_small.png" width="99" height="100"  border="0" alt="" title="" />
    
    
    </div>
        
        <p class="membersince">Member since:<br />09 January 2008</p>
        <p class="posts">Posts: 17</p>
    </td>

    
    <td class="message">
                    <form method="post" action="http://projects.ez.no/content/action">
                <div class="object-right">
                                                </div>
           </form>
       
        <p class="date">Tuesday 09 March 2010 10:04:13 am</p>

        <div class="attribute-long">I want to let you know that I needed to unload mod_deflate to make it works<br />
as noticed here : <a href="http://www.mail-archive.com/" title="http://www.mail-archive.com/">http://www.mail-archive.com/</a><a href='mailto:varnish-misc@projects.linpro.no'>varnish-misc@projects.linpro.no</a>/msg02586.html<br />
<br />
bye
</div>
                    <div class="attribute-signature">
            <p>Pablo Pernot<br />
<a href="http://www.smartview.fr/" title="http://www.smartview.fr">http://www.smartview.fr</a><br />
<a href="http://www.areyouagile.com/" title="http://www.areyouagile.com">http://www.areyouagile.com</a></p>
            </div>
        
                                </td>
    <td class="buttons">
    <div class="button">
        <a href="#main"><img src="../../../extension/ezprojects2007/design/ezprojects2007/images/button-move_up.gif" height="16" width="16" alt="Up" title="Jump to first message" /></a>
    </div>
    </td>
</tr>    




<tr class="bglight" id="msg25143">
    
    <td class="info">
        <p class="author"><a href="../../../users/community/alexandre_nion.html">Alexandre Nion</a></p>


                    <div class="attribute-image">

    
        
    
    <img src="../../../index.html" width="" height=""  border="0" alt="" title="" />
    
    
    </div>
        
        <p class="membersince">Member since:<br />09 January 2008</p>
        <p class="posts">Posts: 5</p>
    </td>

    
    <td class="message">
                    <form method="post" action="http://projects.ez.no/content/action">
                <div class="object-right">
                                                </div>
           </form>
       
        <p class="date">Wednesday 21 April 2010 12:30:44 pm</p>

        <div class="attribute-long">Hi,<br />
<br />
<pre class="wordwrap"><span class="line">I do not think it is a problem to have relative path in your ESI src=&quot;&quot; attribute. As long as the file is accessible directly by your browser it should be fetched by Varnish as well. If for example, from your browser you can access <a href="http://example.com/file.html" title="http://example.com/./path/../to/../file.html">http://example.com/./path/../to/../file.html</a> then Varnish should be able to access the file as well.</span></pre><br />
<br />
Indeed it may be.. <br />
<br />
As defined in ESI specs :<br />
<pre class="wordwrap"><span class="line">Relative URIs will be resolved relative to the template.</span></pre><br />
<br />
eZ Publish handles url aliases but as all requests are managed on web root (via index.php redirection), the real interpretation path remains &quot;/&quot;.<br />
But for Varnish, a slash in url constitutes a new &quot;subfolder&quot; that makes it a new home to be relative to.<br />
<br />
Then when you play with pathes deeper than one level, the created esi request will be erraneous as it considers the last slash as a basis path.<br />
For an ESI block called from a page named &quot;<a href="http://example.com/Folder/Subfolder/The-final-content"" title="http://example.com/Folder/Subfolder/The-final-content&quot;">http://example.com/Folder/Subfolder/The-final-content&quot;</a>, that kind of uri will be produced : <a href="http://example.com/Folder/Subfolder/var/si-blocks/file.htm" title="http://example.com/Folder/Subfolder/var/si-blocks/file.htm">http://example.com/Folder/Subfolder/var/si-blocks/file.htm</a> , which won't be a valid one.<br />
<br />
Possible workarounds I see :<br />
- Hack the FS handler in ezsiblockfunction.php to make the generated &quot;src&quot; absolute from &quot;/&quot; (Valentin's solution)<br />
- Add an Apache rewrite rule to strip the folder path from the ESI request, rewriting them relative to &quot;/&quot; (not very smart..)<br />
- Add a dedicated rule in Varnish VCL, to reconsider the base path before parsing esi tags :<br />
# Parsing ESI tags<br />
set bereq.url = &quot;/&quot;;<br />
esi;<br />
<br />
But currently it doesn't seem to me possible to use the FS handler in a host configuration context without one of those workarounds?<br />
<br />
And right with mod_deflate, I've also lost a few hairs with it... thanks Pablo to point it!
</div>
        
                                </td>
    <td class="buttons">
    <div class="button">
        <a href="#main"><img src="../../../extension/ezprojects2007/design/ezprojects2007/images/button-move_up.gif" height="16" width="16" alt="Up" title="Jump to first message" /></a>
    </div>
    </td>
</tr>
</table>

</div>



 

            <p>You need to be <a href="http://login.ez.no/login?return=http://projects.ez.no/payment">logged in</a> to post messages in the forums. New users may <a href="http://auth.ez.no/user/register">register here</a>.</p>
    
</div>
</div>
</div>



<!-- Main area content: END -->

</div>
</div>
<!-- Main area: END -->
<hr class="hide" />

<!-- Footer area: START -->
<div id="page-width6">
<div id="footer">

<address>Powered by <a href="http://ez.no/ezpublish" title="eZ Publish Content Management System">eZ Publish&reg; Content Management System.</a></address>
<address>Copyright &copy; 2007-2011 eZ Systems AS (except where otherwise noted). All rights reserved.</address>
</div>
</div>
<!-- Footer area: END -->

</div>
<!-- Complete page area: END -->

<!-- BEGIN GA tracker script -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-24601020-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- END GA tracker script -->





</body>

<!-- Mirrored from projects.ez.no/ezsi/forum/general/blocks_not_showing_wrong_src by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 05 Feb 2017 12:40:13 GMT -->
</html>
