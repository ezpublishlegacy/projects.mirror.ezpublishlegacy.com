<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>eZ Projects / epie / Forum / Bug report / Feedback</title>
    <link>http://projects.ez.no/</link>
    <description></description>
    <language>en-GB</language>
    <managingEditor>community@ez.no (Administrator User)</managingEditor>
    <pubDate>Sun, 05 Feb 2017 14:52:21 +0000</pubDate>
    <lastBuildDate>Sun, 05 Feb 2017 14:52:21 +0000</lastBuildDate>
    <generator>eZ Components Feed dev (http://ezcomponents.org/docs/tutorials/Feed)</generator>
    <docs>http://www.rssboard.org/rss-specification</docs>
    <atom:link href="http://projects.ez.no/rss/feed/21860" rel="self" type="application/rss+xml"/>
    <item>
      <title>Watermark image isn't applied when cluster mode is active</title>
      <link>http://projects.ez.no/epie/forum/bug_report_feedback/watermark_image_isn_t_applied_when_cluster_mode_is_active</link>
      <description>I'm using the eZDFSFileHandler and each time that I try to apply a watermark image located in extension/ezie/design/standard/images/watermark, it automatically get deleted and the 'tool_watermark' view returns a 503 response code telling that this image doesn't exist. I found that is due you are treating this file as a clusterized one. I show the working code below:&#13;
&#13;
&lt;code&gt;&#13;
&lt;?php&#13;
class eZIEImageToolWatermark extends eZIEImageAction&#13;
{&#13;
    public static function filter( $region, $image )&#13;
    {&#13;
    	$bases = eZTemplateDesignResource::allDesignBases();&#13;
    	$triedFiles = array();&#13;
    	$fileInfo = eZTemplateDesignResource::fileMatch( $bases, false, "images/watermarks/$image", $triedFiles );&#13;
		if ( !$fileInfo ) {&#13;
			print json_encode(array(&#13;
				'error' =&gt; "watermark image '$image' doesn't exist in any design"&#13;
			));&#13;
			eZExecution::cleanExit();&#13;
		}&#13;
    	$img_path = eZSys::rootDir() . '/' . $fileInfo['path'];&#13;
    	&#13;
        // retrieve image dimensions&#13;
        $analyzer = new ezcImageAnalyzer( $img_path );&#13;
&#13;
        // percentage of the watermark original size to use&#13;
        $pc = $region['w'] / $analyzer-&gt;data-&gt;width;&#13;
&#13;
        return array(&#13;
            new ezcImageFilter(&#13;
                'watermarkAbsolute',&#13;
                array(&#13;
                    'image'  =&gt; $img_path,&#13;
                    'posX'   =&gt; $region['x'],&#13;
                    'posY'   =&gt; $region['y'],&#13;
                    'width'  =&gt; intval( $region['w'] ),&#13;
                    'height' =&gt; intval( $region['h'] )&#13;
                )&#13;
            )&#13;
        );&#13;
    }&#13;
}&#13;
?&gt;&#13;
&lt;/code&gt;&#13;
&#13;
As you can realise, I also have added support to put the watermark in any registered design, and not only inside the extension.</description>
      <author>community@ez.no (Bayron Guevara)</author>
      <guid>http://projects.ez.no/epie/forum/bug_report_feedback/watermark_image_isn_t_applied_when_cluster_mode_is_active</guid>
      <pubDate>Thu, 16 Dec 2010 00:00:07 +0000</pubDate>
    </item>
  </channel>
</rss>