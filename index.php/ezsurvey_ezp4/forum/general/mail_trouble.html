<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">



<!-- Mirrored from projects.ez.no/index.php/ezsurvey_ezp4/forum/general/mail_trouble by HTTrack Website Copier/3.x [XR&CO'2013], Mon, 06 Feb 2017 01:46:32 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>                                                                                
<title>
            Mail trouble     /         General     /         Forum        
</title>

<meta http-equiv="Content-Language" content="en-GB" />
    <meta name="author" content="eZ Systems" />
    <meta name="copyright" content="eZ Systems" />
    <meta name="description" content="Content Management System" />
    <meta name="keywords" content="cms, publish, e-commerce, content management, development framework" />

<meta name="MSSmartTagsPreventParsing" content="TRUE" />
<meta name="generator" content="eZ Publish" />

<style type="text/css">
    @import url(../../../../extension/ezprojects2007/design/ezprojects2007/stylesheets/core.css);
    @import url(../../../../extension/ezprojects2007/design/ezprojects2007/stylesheets/pagelayout.css);
    @import url(../../../../extension/ezprojects2007/design/ezprojects2007/stylesheets/classes.css);
    @import url(../../../../extension/ezprojects2007/design/ezprojects2007/stylesheets/print.css) print;
</style>

<link type="text/css" rel="stylesheet" href="../../../../extension/ezprojects2007/design/ezprojects2007/stylesheets/print.css" media="print" />

<!-- IE conditional comments; for bug fixes for different IE versions -->
<!--[if IE 5]>     <style type="text/css"> @import url(/extension/ezprojects2007/design/ezprojects2007/stylesheets/ie5.css);    </style> <![endif]-->
<!--[if lte IE 6]> <style type="text/css"> @import url(/extension/ezprojects2007/design/ezprojects2007/stylesheets/ie6lte.css); </style> <![endif]-->
<!--[if IE 6]>     <style type="text/css"> @import url(/extension/ezprojects2007/design/ezprojects2007/stylesheets/ie6.css);    </style> <![endif]-->

<!-- Load special stylesheet (if necessary) for newer Netscape decendants, Mozilla and Firefox, using the Gecko renderer -->
<script type="text/javascript"><!-- if ((navigator.userAgent.indexOf("Gecko") != -1)&&(navigator.userAgent.indexOf("KHTML") == -1)) document.write("<style type=\"text/css\">@import url(/extension/ezprojects2007/design/ezprojects2007/stylesheets/gecko.css);</style>");--></script>

<script type="text/javascript" src="../../../../extension/ezprojects2007/design/ezprojects2007/javascripts/switch-width.js"></script>

<script type="text/javascript" src="../../../../extension/ezprojects2007/design/ezprojects2007/javascripts/dropdownmenu.js"></script>
<script type="text/javascript" src="../../../../extension/ezprojects2007/design/ezprojects2007/javascripts/insertmedia.js"></script>
<script type="text/javascript" src="../../../../extension/ezprojects2007/design/ezprojects2007/javascripts/link-target.js"></script>

<script type="text/javascript" src="../../../../var/plain_site/cache/public/javascript/059cd8e3b9fa455a526077cbccc48048.js" charset="utf-8"></script>


</head>
<body onload="menuInit();">

<!-- Complete page area: START -->
<div id="page">

<!-- Header area: START -->
<div id="header">
<div id="header-insert">

<!-- User menu area: START -->
<div id="usermenu">

<div id="page-width1">

<div id="logo">
<h1><a href="../../../../index.html"><span class="hide">eZ Systems</span></a></h1>
</div>

<h2 id="slogan">Share your information</h2>

<p class="hide"><a href="#main">Skip to main content</a></p>

<hr class="hide" />
<div id="searchbox">
<form action="http://projects.ez.no/content/advancedsearch" method="get">

<div class="block">
<div class="element">
<input id="searchbutton" class="button" type="submit" value="Search" />
</div>

<div class="element searchstring">
    <label for="searchtext" class="hide">Search text:</label>
    <input id="searchtext" name="SearchText" type="text" size="12" />
    

    </div>

</div>
</form>
</div>

<hr class="hide" />
<h2 class="hide">User menu</h2>

<!-- User menu content: START -->
<ul>
            <li><a href="../../../user/register.html">Become a member of the eZ Community</a></li>
        <li><a href="../../../user/forgotpassword.html">Lost password?</a></li>
    
    <li>
    
    <script type="text/javascript">
    <!--
    if ( fixedSize )
    {
        document.write('<a id="setwidth" href="#" onclick="setWidth(); return false;">Dynamic width</a>');
    }
    else
    {
        document.write('<a id="setwidth" href="#" onclick="setWidth(); return false;">Fixed width</a>');
    }
    -->
    </script>
    
    </li>
    
            <li><a href="../../../user/login.html">Log in</a></li>
    </ul>
<!-- User menu content: END -->

</div>

</div>
<!-- User menu area: END -->

</div>
</div>
<!-- Header area: END -->

                    
<script type="text/javascript">
<!--
var menu = new Array();

menu[0] = [];
menu[1] = [];
menu[2] = [];
menu[3] = ['General', '/ezsurvey_ezp4/forum/general'];
menu[4] = ['Leaders', '/ezsurvey_ezp4/team/leaders', 'Members', '/ezsurvey_ezp4/team/members'];
menu[5] = [];
menu[6] = [];
menu[7] = [];

-->
</script>
<div id="menuborder">

<!-- Main menu area: START -->
<div id="menu" onmouseover="menuHover();" onmouseout="tryHideSubMenues();">

<div id="mainmenu" class="float-break">
<div id="page-width2">
    <ul id="mainmenulist" class="float-break">

    <li class="project" ><a href="../../../../ezsurvey_ezp4.html" onmouseover="switchSubMenu( this );">eZSurvey &nbsp;&nbsp;&gt;&gt;</a></li>
                        <li ><a href="../../../../ezsurvey_ezp4/news.html" onmouseover="switchSubMenu( this );">News</a></li>
                            <li ><a href="../../../../ezsurvey_ezp4/downloads.html" onmouseover="switchSubMenu( this );">Downloads</a></li>
                            <li class="current"><a href="../../../../ezsurvey_ezp4/forum.html" onmouseover="switchSubMenu( this );">Forum</a></li>
                            <li ><a href="../../../../ezsurvey_ezp4/team.html" onmouseover="switchSubMenu( this );">Team</a></li>
                            <li ><a href="../../../../ezsurvey_ezp4/subversion.html" onmouseover="switchSubMenu( this );">Source</a></li>
                            <li ><a href="../../../../ezsurvey_ezp4/gallery.html" onmouseover="switchSubMenu( this );">Gallery</a></li>
                            <li class="last"><a href="../../../../ezsurvey_ezp4/reviews.html" onmouseover="switchSubMenu( this );">Reviews</a></li>
        
    </ul>

</div>
</div>


<div id="submenu">
<div id="page-width3">
    <ul class="float-break">

                    
            
    <li class="last current"><a href="../../../../ezsurvey_ezp4/forum/general.html">General</a></li>

        

</ul>
</div>
</div>

<script type="text/javascript"><!--
document.getElementById('submenu').style.display = 'none';
--></script>

</div>
<!-- Main menu area: END -->

</div>

<hr class="hide" />
<!-- Path area: START -->
<div id="path">

<div id="page-width4">
<h2 class="hide">Path</h2>

<!-- Path content: START -->
<p>
                                    <a href="../../../content/view/full/2.html">ez projects</a>
                    
                        /
                            <a href="../../../ezsurvey_ezp4.html">ezsurvey_ezp4</a>
        
                        /
                            <a href="../../forum.html">forum</a>
        
                        /
                            <a href="../general.html">general</a>
        
                        /
                                        mail trouble
                    
            </p>
<!-- Path content: END -->

</div>

</div>
<!-- Path area: END -->

<hr class="hide" />

<!-- Main area: START -->

<div id="page-width5">
<div id="main" class="float-break">

<!-- Main area content: START -->




<div class="template-design area-main-full">
<div class="template-module content-view-full">
<div class="template-object class-forummessage">



<div id="top" class="attribute-heading">
    <h1>Mail trouble</h1>
</div>


    <p>You need to be <a href="../../../user/login.html">logged in</a> to post messages in the forums. New users may <a href="http://auth.ez.no/user/register">register here</a>.</p>


 



<div class="content-view-children">

<table class="forum list" cellspacing="0">

    




<tr class="bglight" id="msg13496">
    
    <td class="info">
        <p class="author"><a href="../../../users/community/paal_messenlien.html">PÃ¥l Messenlien</a></p>


                    <div class="attribute-image">

    
        
    
    <img src="../../../../index.html" width="" height=""  border="0" alt="" title="" />
    
    
    </div>
        
        <p class="membersince">Member since:<br />09 January 2008</p>
        <p class="posts">Posts: 5</p>
    </td>

    
    <td class="message">
                    <form method="post" action="http://projects.ez.no/index.php/content/action">
                <div class="object-right">
                                                </div>
           </form>
       
        <p class="date">Tuesday 13 January 2009 1:09:42 am</p>

        <div class="attribute-long">Im trying to add some functions to the survey mail. My trouble are that the mail received in gmail stacks every sent survey. This is no good. I also want the mail to add the mail address and from name of the sender. Another problem is that the survey name don't add to the subject in a mail. It only says Filled Survey at the moment.<br />
Tried several things tonight, and this is the code i am at now.<br />
<br />
<pre class="wordwrap"><span class="line"></span>

<span class="line">{set-block scope=root variable=subject}{$node.name}{/set-block}</span>

<span class="line">{set-block scope=root variable=from}Paal{/set-block}</span>

<span class="line">{set-block scope=root variable=reply_to}<a href='mailto:paal@messenlien.com'>paal@messenlien.com</a>{/set-block}</span>

<span class="line"></span></pre><br />
<br />
Have not started to extract mail information yet.<br />
Not sure why the set-block variable wont work here. Have used that in templates before.<br />
Any suggestions or help out there?
</div>
                    <div class="attribute-signature">
            <p>--------------------------------------------<br />
Vangen &amp; Plotz<br />
<a href="http://vangenplotz.no/" title="http://vangenplotz.no">http://vangenplotz.no</a><br />
-------------------------------------------</p>
            </div>
        
                                </td>
    <td class="buttons">
    <div class="button">
        <a href="#main"><img src="../../../../extension/ezprojects2007/design/ezprojects2007/images/button-move_up.gif" height="16" width="16" alt="Up" title="Jump to first message" /></a>
    </div>
    </td>
</tr>
    




<tr class="bgdark" id="msg13500">
    
    <td class="info">
        <p class="author"><a href="../../../users/community/bjoern_reiten2.html">BjÃ¸rn Reiten</a></p>


                    <div class="attribute-image">

    
        
    
    <img src="../../../../index.html" width="" height=""  border="0" alt="" title="" />
    
    
    </div>
        
        <p class="membersince">Member since:<br />11 March 2003</p>
        <p class="posts">Posts: 41</p>
    </td>

    
    <td class="message">
                    <form method="post" action="http://projects.ez.no/index.php/content/action">
                <div class="object-right">
                                                </div>
           </form>
       
        <p class="date">Tuesday 13 January 2009 9:29:47 am</p>

        <div class="attribute-long">I think the mail problem may be because of that the reference headers are not set in eZ Survey .. and therefore just handled by the standard eZMail classes in eZ Publish itself.<br />
<br />
Your template code looks like a good way to solve this. So the only thing left is to receive the variables you're setting in the PHP code as well. This is done in the eZSurvey datatype itself (ezsurveytype.php).<br />
<br />
Cheers, BjÃ¸rn
</div>
        
                                </td>
    <td class="buttons">
    <div class="button">
        <a href="#main"><img src="../../../../extension/ezprojects2007/design/ezprojects2007/images/button-move_up.gif" height="16" width="16" alt="Up" title="Jump to first message" /></a>
    </div>
    </td>
</tr>    




<tr class="bglight" id="msg13550">
    
    <td class="info">
        <p class="author"><a href="../../../users/community/paal_messenlien.html">PÃ¥l Messenlien</a></p>


                    <div class="attribute-image">

    
        
    
    <img src="../../../../index.html" width="" height=""  border="0" alt="" title="" />
    
    
    </div>
        
        <p class="membersince">Member since:<br />09 January 2008</p>
        <p class="posts">Posts: 5</p>
    </td>

    
    <td class="message">
                    <form method="post" action="http://projects.ez.no/index.php/content/action">
                <div class="object-right">
                                                </div>
           </form>
       
        <p class="date">Friday 16 January 2009 10:56:41 am</p>

        <div class="attribute-long">Thanks, got it solved by changing the datatype file<br />
<br />
<pre class="wordwrap"><span class="line"></span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$templateResult = $tpl_email-&gt;fetch( 'design:survey/mail.tpl' );</span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$subject = $tpl_email-&gt;variable( 'subject' );</span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$emailSender = $tpl_email-&gt;variable( 'from' );</span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail = new eZMail();</span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ini = eZINI::instance();</span>

<span class="line">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$emailSender = $ini-&gt;variable( 'MailSettings', 'EmailSender' );</span>

<span class="line">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( !$emailSender )</span>

<span class="line">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$emailSender = $ini-&gt;variable( 'MailSettings', 'AdminEmail' );</span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail-&gt;setSenderText( $emailSender );&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail-&gt;setReceiver( $mailTo );</span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail-&gt;setSubject( $subject );</span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail-&gt;setBody( $templateResult );</span>

<span class="line"></span></pre><br />
And the mail template code<br />
<br />
<pre class="wordwrap"><span class="line"></span>

<span class="line">{def $timestamp=currentdate()}</span>

<span class="line">{def $sender = = ezini( 'MailSettings', 'AdminEmail', 'site.ini' )}</span>

<span class="line">{set-block scope=root variable=subject}[{$timestamp|l10n( 'shortdatetime' )}-{$survey.id}]{$node.name}{/set-block}</span>

<span class="line">{foreach $survey_questions as $question}</span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{switch match=$question.type}</span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{case match='EmailEntry'}</span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{set $sender = $question.answer}</span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{/case}</span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{/switch}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>

<span class="line">{/foreach}</span>

<span class="line">{set-block scope=root variable=from}{$sender}{/set-block}</span>

<span class="line">{&quot;The following information was collected as the result of the survey:&quot;|i18n('survey')}</span>

<span class="line">&lt;br&gt;</span>

<span class="line">{section var=question loop=$survey_questions}</span>

<span class="line">{survey_question_result_gui view=mail question=$question}</span>

<span class="line">{/section}</span>

<span class="line"></span></pre><br />
<br />
I have also made some template changes so the mail is being sent as html so the mail result is more understanding.<br />
Can upload it as a hack project for the extension if someone need it.
</div>
                    <div class="attribute-signature">
            <p>--------------------------------------------<br />
Vangen &amp; Plotz<br />
<a href="http://vangenplotz.no/" title="http://vangenplotz.no">http://vangenplotz.no</a><br />
-------------------------------------------</p>
            </div>
        
                                </td>
    <td class="buttons">
    <div class="button">
        <a href="#main"><img src="../../../../extension/ezprojects2007/design/ezprojects2007/images/button-move_up.gif" height="16" width="16" alt="Up" title="Jump to first message" /></a>
    </div>
    </td>
</tr>
</table>

</div>



 

            <p>You need to be <a href="../../../user/login.html">logged in</a> to post messages in the forums. New users may <a href="http://auth.ez.no/user/register">register here</a>.</p>
    
</div>
</div>
</div>



<!-- Main area content: END -->

</div>
</div>
<!-- Main area: END -->
<hr class="hide" />

<!-- Footer area: START -->
<div id="page-width6">
<div id="footer">

<address>Powered by <a href="http://ez.no/ezpublish" title="eZ Publish Content Management System">eZ Publish&reg; Content Management System.</a></address>
<address>Copyright &copy; 2007-2011 eZ Systems AS (except where otherwise noted). All rights reserved.</address>
</div>
</div>
<!-- Footer area: END -->

</div>
<!-- Complete page area: END -->

<!-- BEGIN GA tracker script -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-24601020-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- END GA tracker script -->





</body>

<!-- Mirrored from projects.ez.no/index.php/ezsurvey_ezp4/forum/general/mail_trouble by HTTrack Website Copier/3.x [XR&CO'2013], Mon, 06 Feb 2017 01:46:32 GMT -->
</html>
