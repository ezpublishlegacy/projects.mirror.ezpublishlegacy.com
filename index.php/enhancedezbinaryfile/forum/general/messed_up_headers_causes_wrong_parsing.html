<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">



<!-- Mirrored from projects.ez.no/index.php/enhancedezbinaryfile/forum/general/messed_up_headers_causes_wrong_parsing by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 05 Feb 2017 22:04:33 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>                                                                                
<title>
            Messed up headers causes wrong parsing     /         General     /         Forum        
</title>

<meta http-equiv="Content-Language" content="en-GB" />
    <meta name="author" content="eZ Systems" />
    <meta name="copyright" content="eZ Systems" />
    <meta name="description" content="Content Management System" />
    <meta name="keywords" content="cms, publish, e-commerce, content management, development framework" />

<meta name="MSSmartTagsPreventParsing" content="TRUE" />
<meta name="generator" content="eZ Publish" />

<style type="text/css">
    @import url(../../../../extension/ezprojects2007/design/ezprojects2007/stylesheets/core.css);
    @import url(../../../../extension/ezprojects2007/design/ezprojects2007/stylesheets/pagelayout.css);
    @import url(../../../../extension/ezprojects2007/design/ezprojects2007/stylesheets/classes.css);
    @import url(../../../../extension/ezprojects2007/design/ezprojects2007/stylesheets/print.css) print;
</style>

<link type="text/css" rel="stylesheet" href="../../../../extension/ezprojects2007/design/ezprojects2007/stylesheets/print.css" media="print" />

<!-- IE conditional comments; for bug fixes for different IE versions -->
<!--[if IE 5]>     <style type="text/css"> @import url(/extension/ezprojects2007/design/ezprojects2007/stylesheets/ie5.css);    </style> <![endif]-->
<!--[if lte IE 6]> <style type="text/css"> @import url(/extension/ezprojects2007/design/ezprojects2007/stylesheets/ie6lte.css); </style> <![endif]-->
<!--[if IE 6]>     <style type="text/css"> @import url(/extension/ezprojects2007/design/ezprojects2007/stylesheets/ie6.css);    </style> <![endif]-->

<!-- Load special stylesheet (if necessary) for newer Netscape decendants, Mozilla and Firefox, using the Gecko renderer -->
<script type="text/javascript"><!-- if ((navigator.userAgent.indexOf("Gecko") != -1)&&(navigator.userAgent.indexOf("KHTML") == -1)) document.write("<style type=\"text/css\">@import url(/extension/ezprojects2007/design/ezprojects2007/stylesheets/gecko.css);</style>");--></script>

<script type="text/javascript" src="../../../../extension/ezprojects2007/design/ezprojects2007/javascripts/switch-width.js"></script>

<script type="text/javascript" src="../../../../extension/ezprojects2007/design/ezprojects2007/javascripts/dropdownmenu.js"></script>
<script type="text/javascript" src="../../../../extension/ezprojects2007/design/ezprojects2007/javascripts/insertmedia.js"></script>
<script type="text/javascript" src="../../../../extension/ezprojects2007/design/ezprojects2007/javascripts/link-target.js"></script>

<script type="text/javascript" src="../../../../var/plain_site/cache/public/javascript/059cd8e3b9fa455a526077cbccc48048.js" charset="utf-8"></script>


</head>
<body onload="menuInit();">

<!-- Complete page area: START -->
<div id="page">

<!-- Header area: START -->
<div id="header">
<div id="header-insert">

<!-- User menu area: START -->
<div id="usermenu">

<div id="page-width1">

<div id="logo">
<h1><a href="../../../../index.html"><span class="hide">eZ Systems</span></a></h1>
</div>

<h2 id="slogan">Share your information</h2>

<p class="hide"><a href="#main">Skip to main content</a></p>

<hr class="hide" />
<div id="searchbox">
<form action="http://projects.ez.no/content/advancedsearch" method="get">

<div class="block">
<div class="element">
<input id="searchbutton" class="button" type="submit" value="Search" />
</div>

<div class="element searchstring">
    <label for="searchtext" class="hide">Search text:</label>
    <input id="searchtext" name="SearchText" type="text" size="12" />
    

    </div>

</div>
</form>
</div>

<hr class="hide" />
<h2 class="hide">User menu</h2>

<!-- User menu content: START -->
<ul>
            <li><a href="../../../user/register.html">Become a member of the eZ Community</a></li>
        <li><a href="../../../user/forgotpassword.html">Lost password?</a></li>
    
    <li>
    
    <script type="text/javascript">
    <!--
    if ( fixedSize )
    {
        document.write('<a id="setwidth" href="#" onclick="setWidth(); return false;">Dynamic width</a>');
    }
    else
    {
        document.write('<a id="setwidth" href="#" onclick="setWidth(); return false;">Fixed width</a>');
    }
    -->
    </script>
    
    </li>
    
            <li><a href="../../../user/login.html">Log in</a></li>
    </ul>
<!-- User menu content: END -->

</div>

</div>
<!-- User menu area: END -->

</div>
</div>
<!-- Header area: END -->

                    
<script type="text/javascript">
<!--
var menu = new Array();

menu[0] = [];
menu[1] = [];
menu[2] = [];
menu[3] = ['General', '/enhancedezbinaryfile/forum/general'];
menu[4] = ['Leaders', '/enhancedezbinaryfile/team/leaders', 'Members', '/enhancedezbinaryfile/team/members'];
menu[5] = [];
menu[6] = [];
menu[7] = [];

-->
</script>
<div id="menuborder">

<!-- Main menu area: START -->
<div id="menu" onmouseover="menuHover();" onmouseout="tryHideSubMenues();">

<div id="mainmenu" class="float-break">
<div id="page-width2">
    <ul id="mainmenulist" class="float-break">

    <li class="project" ><a href="../../../../enhancedezbinaryfile.html" onmouseover="switchSubMenu( this );">Enhanced eZ Binary File Type &nbsp;&nbsp;&gt;&gt;</a></li>
                        <li ><a href="../../../../enhancedezbinaryfile/news.html" onmouseover="switchSubMenu( this );">News</a></li>
                            <li ><a href="../../../../enhancedezbinaryfile/downloads.html" onmouseover="switchSubMenu( this );">Downloads</a></li>
                            <li class="current"><a href="../../../../enhancedezbinaryfile/forum.html" onmouseover="switchSubMenu( this );">Forum</a></li>
                            <li ><a href="../../../../enhancedezbinaryfile/team.html" onmouseover="switchSubMenu( this );">Team</a></li>
                            <li ><a href="../../../../enhancedezbinaryfile/subversion.html" onmouseover="switchSubMenu( this );">Source</a></li>
                            <li ><a href="../../../../enhancedezbinaryfile/gallery.html" onmouseover="switchSubMenu( this );">Gallery</a></li>
                            <li class="last"><a href="../../../../enhancedezbinaryfile/reviews.html" onmouseover="switchSubMenu( this );">Reviews</a></li>
        
    </ul>

</div>
</div>


<div id="submenu">
<div id="page-width3">
    <ul class="float-break">

                    
            
    <li class="last current"><a href="../../../../enhancedezbinaryfile/forum/general.html">General</a></li>

        

</ul>
</div>
</div>

<script type="text/javascript"><!--
document.getElementById('submenu').style.display = 'none';
--></script>

</div>
<!-- Main menu area: END -->

</div>

<hr class="hide" />
<!-- Path area: START -->
<div id="path">

<div id="page-width4">
<h2 class="hide">Path</h2>

<!-- Path content: START -->
<p>
                                    <a href="../../../content/view/full/2.html">ez projects</a>
                    
                        /
                            <a href="../../../enhancedezbinaryfile.html">enhancedezbinaryfile</a>
        
                        /
                            <a href="../../forum.html">forum</a>
        
                        /
                            <a href="../general.html">general</a>
        
                        /
                                        messed up headers causes wr...
                    
            </p>
<!-- Path content: END -->

</div>

</div>
<!-- Path area: END -->

<hr class="hide" />

<!-- Main area: START -->

<div id="page-width5">
<div id="main" class="float-break">

<!-- Main area content: START -->




<div class="template-design area-main-full">
<div class="template-module content-view-full">
<div class="template-object class-forummessage">



<div id="top" class="attribute-heading">
    <h1>Messed up headers causes wrong parsing</h1>
</div>


    <p>You need to be <a href="../../../user/login.html">logged in</a> to post messages in the forums. New users may <a href="http://auth.ez.no/user/register">register here</a>.</p>


 



<div class="content-view-children">

<table class="forum list" cellspacing="0">

    




<tr class="bglight" id="msg23334">
    
    <td class="info">
        <p class="author"><a href="../../../users/community/denitsa_m.html">Denitsa M</a></p>


                    <div class="attribute-image">

    
        
    
    <img src="../../../../index.html" width="" height=""  border="0" alt="" title="" />
    
    
    </div>
        
        <p class="membersince">Member since:<br />08 May 2007</p>
        <p class="posts">Posts: 11</p>
    </td>

    
    <td class="message">
                    <form method="post" action="http://projects.ez.no/index.php/content/action">
                <div class="object-right">
                                                </div>
           </form>
       
        <p class="date">Tuesday 16 February 2010 3:34:52 pm</p>

        <div class="attribute-long">Hi,<br />
<br />
extension is very good, considering the attachment functionality in collect info is so handy, and working in 4.2. However, the code addition for kernel produces invalid headers and causes wrong message parsing in mail clients (in all I tested, including google and yahoo). The messages during my tests were not passing my mailguard software and were categorized immediately as &quot;messages with invalid headers&quot;. The attachments were not recognized at all as attachments due to this header messup, and this is why the attachment(s) code is simply considered as plain text and put in letter content.<br />
<br />
I think the usage of the $mail-&gt;setContentType(); with few values at the same time as content-type param should be revised. I changed some of the code in kernel collectinformation script and currently for me it produces messages with 100% valid content and headers:<br />
<br />
<pre class="wordwrap"><span class="line"></span>

<span class="line">Index: kernel/content/collectinformation.php</span>

<span class="line">===================================================================</span>

<span class="line">--- kernel/content/collectinformation.php&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(revision 85879)</span>

<span class="line">+++ kernel/content/collectinformation.php&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(working copy)</span>

<span class="line">@@ -349,6 +349,47 @@</span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>

<span class="line">&nbsp;</span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail-&gt;setSubject( $subject );</span>

<span class="line">+</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// begin modification</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fileAttachments=array();</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attachementMessage = '';</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach ( array_keys( $contentObjectAttributes ) as $key )</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $contentObjectAttributes[$key]-&gt;DataTypeString === 'enhancedezbinaryfile' )</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$id = $contentObjectAttributes[$key]-&gt;attribute( 'id' );</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$xmlText = $collectionAttributes[$id]-&gt;DataText;</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( trim( $xmlText ) !== '' )</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$dom = new DOMDocument( '1.0', 'utf-8' );</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $dom-&gt;loadXML( $xmlText ) )</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$originalFilename = $dom-&gt;getElementsByTagName( 'OriginalFilename' )-&gt;item(0)-&gt;textContent;</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fileType = $dom-&gt;getElementsByTagName( 'Type' )-&gt;item(0)-&gt;textContent;</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$filename = $dom-&gt;getElementsByTagName( 'Filename' )-&gt;item(0)-&gt;textContent;</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( file_exists( eZSys::wwwDir() . $filename ) ) {</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fileAttachments[]=array( eZSys::wwwDir() . $filename, $originalFilename, $fileType );</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( count( $fileAttachments ) !== 0 )</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uid = &quot;YourFrameworkName-Mail--&quot; . md5( uniqid( time() ) );</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach ( $fileAttachments as $attacharray)</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$filedata = chunk_split( base64_encode( eZFile::getContents( $attacharray[0] ) ) );</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attachementMessage .= &quot;--$uid\r\nContent-Disposition: attachment; filename=\&quot;$attacharray[1]\&quot;\r\nContent-Type: $attacharray[2]; name=\&quot;$attacharray[1]\&quot;\r\nContent-Transfer-Encoding: base64\r\n\r\n$filedata\r\n\r\n&quot;;</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attachementMessage .= &quot;--$uid--\r\n\r\n&quot;;</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mainHeader .= &quot;--$uid\r\nContent-type:text/plain; charset=utf-8\r\nContent-Transfer-Encoding: 8bit\r\n\r\n&quot;;</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$templateResult = $mainHeader . $templateResult . &quot;\r\n\r\n&quot; . $attachementMessage;</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail-&gt;setContentType( &quot;multipart/mixed&quot;, &quot;utf-8&quot;, &quot;8bit&quot;, false, $uid );</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>

<span class="line">+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//end modifications</span>

<span class="line">+</span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mail-&gt;setBody( $templateResult );</span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mailResult = eZMailTransport::send( $mail );</span>

<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>

<span class="line"></span></pre><br />
<br />
I kept the first half of the code, but I changed some things in the second part for adding the attachments into the mail. This code also displays the special chars correctly, and in all my tests  after my changes in the code I didn't notice any scrambles or wrong encoding in the emails.<br />
<br />
It took me quite a time to check different messages and compare during debug, since I don't know much about mail and so on, so I hope this helps anyone who has problems with the header text appearing in the letter content or the charset.<br />
<br />
Deni
</div>
                    <div class="attribute-signature">
            <p>Iguana IT - <a href="http://www.iguanait.com/" title="http://www.iguanait.com">http://www.iguanait.com</a></p>
            </div>
        
                                </td>
    <td class="buttons">
    <div class="button">
        <a href="#main"><img src="../../../../extension/ezprojects2007/design/ezprojects2007/images/button-move_up.gif" height="16" width="16" alt="Up" title="Jump to first message" /></a>
    </div>
    </td>
</tr>
    




<tr class="bgdark" id="msg23336">
    
    <td class="info">
        <p class="author"><a href="../../../users/community/steven_e_bailey.html">Steven E Bailey</a></p>


                    <div class="attribute-image">

    
        
    
    <img src="../../../../var/plain_site/storage/images/users/community/steven_e_bailey/32288-148-eng-GB/steven_e_bailey_small.jpg" width="100" height="100"  border="0" alt="" title="" />
    
    
    </div>
        
        <p class="membersince">Member since:<br />27 April 2006</p>
        <p class="posts">Posts: 54</p>
    </td>

    
    <td class="message">
                    <form method="post" action="http://projects.ez.no/index.php/content/action">
                <div class="object-right">
                                                </div>
           </form>
       
        <p class="date">Tuesday 16 February 2010 4:10:55 pm</p>

        <div class="attribute-long">I'm not sure what you're talking about - I tested, among others, yahoo and gmail and never got what you are saying you got.<br />
<br />
What is the exact text you were testing with?  When I get a chance I'll take a look at it again.  It's been a while.
</div>
                    <div class="attribute-signature">
            <p><a href="http://www.leidentech.com/" title="http://www.leidentech.com">http://www.leidentech.com</a><br />
eZPublishLegacy - eZ Publish Release Mirror | <a href="http://ezpublishlegacy.com/" title="http://ezpublishlegacy.com">http://ezpublishlegacy.com</a></p>
            </div>
        
                                </td>
    <td class="buttons">
    <div class="button">
        <a href="#main"><img src="../../../../extension/ezprojects2007/design/ezprojects2007/images/button-move_up.gif" height="16" width="16" alt="Up" title="Jump to first message" /></a>
    </div>
    </td>
</tr>    




<tr class="bglight" id="msg23340">
    
    <td class="info">
        <p class="author"><a href="../../../users/community/denitsa_m.html">Denitsa M</a></p>


                    <div class="attribute-image">

    
        
    
    <img src="../../../../index.html" width="" height=""  border="0" alt="" title="" />
    
    
    </div>
        
        <p class="membersince">Member since:<br />08 May 2007</p>
        <p class="posts">Posts: 11</p>
    </td>

    
    <td class="message">
                    <form method="post" action="http://projects.ez.no/index.php/content/action">
                <div class="object-right">
                                                </div>
           </form>
       
        <p class="date">Tuesday 16 February 2010 5:19:09 pm</p>

        <div class="attribute-long">Hi, Steven,<br />
<br />
Thanks for reply. I was referring to the problem described here <a href="../../../../enhancedezbinaryfile/forum/general/works_fine_but.html#msg13493" title="http://projects.ez.no/enhancedezbinaryfile/forum/general/works_fine_but#msg13493">http://projects.ez.no/enhancedezb...orum/general/works_fine_but#msg13493</a> this is appearing in my mail client (in particular -  Evolution) and following this header code I can see the content of the attachment right into the body of the message I get in web mail clients like gmail (txt, image, etc). Specifically I mean that when receiving mail, my mailguard software is marking each message as &quot;invalid header message&quot; and they never get to my inbox, if I have for example set &quot;quarantine invalid header messages&quot;.<br />
<br />
For example, attaching image puts this in my message body:<br />
<br />
<pre class="wordwrap"><span class="line"></span>

<span class="line">&nbsp;</span>

<span class="line">--==Multipart_Boundary_5124c83585ccb15e07929500b867b98e</span>

<span class="line">Content-Type: image/jpeg; charset=utf-8</span>

<span class="line">name=image.jpg</span>

<span class="line">Content-Transfer-Encoding: base64</span>

<span class="line">Content-Disposition: inline;</span>

<span class="line">filename=image.jpg</span>

<span class="line">{Encrypted base64 file}==</span>

<span class="line">&nbsp;</span>

<span class="line">/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAUDBAQEAwUEBAQFBQUGBwwIBwcHBw8LCwkMEQ8SEhEP</span>

<span class="line">ERETFhwXExQaFRERGCEYGh0dHx8fExciJCIeJBweHx7/2wBDAQUFBQcGBw4ICA4eFBEUHh4eHh4e</span>

<span class="line">Hh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCAJYAyADASIA</span>

<span class="line">AhEBAxEB/8QAHAAAAgIDAQEAAAAAAAAAAAAAAwQCBQABBgcI/8QAUBAAAQMDAgMGBAQEAwUFBQYH</span>

<span class="line">AQIDEQAEIRIxBUFRBhMiYXGBFDKRoQexwfAjQtHhFVLxFiQzYnIIQ4KSsiU0c6LCF0RTY2Sz0jVF</span>

<span class="line">VZOj8v/EABsBAAMBAQEBAQAAAAAAAAAAAAECAwAEBQYH/8QANBEAAgIBBAECBAQFBQEBAQAAAAEC</span>

<span class="line">EQMEEiExQRNRBRQiYTJxkaFCgbHR8BUjUsHh8TOS/9oADAMBAAIRAxEAPwDntBFGRgxFDeGhR8eO</span>

<span class="line">VaQ6RjNfn3Z+r2kxxswBjzxTTQMSTHlSHxTSUapJVU2r5BwcVNxbRRTRatqAV4jPKm0OISj5pqiN</span>

<span class="line">23AhwkmjJuklPhI+tI8ZWOVLoufiBsI881iVknnFU6bkTg00xcTB1bcqVwoZZLLCSeWOdTTHQClU</span>

<span class="line">vSkenWiJdJM4pdpTchgITB8+lQcSEjEURglWPsaYSxrOf6UqlTKbbXBVLJ1wnf12rFuJQjcEjyqy</span>

<span class="line">Vw07gEneKQvLJxIJ0KEflTRnFkpRkhAuKWsnUR6GnbBSwYWTpml2mFyIEU9ZW6ifEggDFPNqhMab</span>

<span class="line">YVx0atIbCq07bIUgqSYPQ007bd3BSCfPrQVIVGSAU7VOLXgs17lbdcPUoDwZPlVTc2ikOQTPKuiV</span>

<span class="line">cFKSM+4pB2HFauZzVYTkuzmyQg+inQhSFSE1MyUnUJB8qsCG52GagsonCRFW3kdlFato7kfSoaCm</span>

<span class="line">Dt+tWKmgs4/KoG2UnJBplNCOHsKISR50ZpBKRypgNRIA+1GbZJ/lA9aDkhlEGwwDGPaN6bbtsZFF</span>

<span class="line">Q0EcjHWmWEEEEdKm2WjEgxaaiOVPtW6EiTyrTaQBkke1NtAEABI571GTZ0RSRNm2BEhI+lGRbSCd</span>

<span class="line">P6UxaoGM04G/DtFc0pNMEp7SrNuQrAozY0gAxPlTa2FKODHpW/hcQrGKznfYvqLyDQQo8hFHSjAj</span>

<span class="line">eo9yZmppBGSam+RJST6JIo7cqHKgpBnb6Uw1Hrmg0QmwwRgRgxRkIVPvUGRqEU6y2DBp4xs48k6N</span>

<span class="line">MpV0+oo/f90QCSCftU0aEbkUlxDQoiD9Kq/pXBzKpypjyL1kHChSbtw4twnvDv1pBTzYkBQxQ/im</span>

<span class="line">woAkCl3SZeGmS5RYuPGJEz1FBaD9wslBilhejrNNWvEG2h8vPpStO+RnjlGPC5D3N09Yt6FK8REA</span>

<span class="line">TiqPibqHf4hUEqjrW+LXqrl/UY2gVUXQWBJVA3iaFOT+x..........................</span>

<span class="line">&nbsp;</span>

<span class="line"></span></pre><br />
<br />
Assuming invalid header, I guess the mail client simply parse the attachment part as plain text, this is why it appears into the body of message, and there are no attachments into the letter.<br />
<br />
Deni
</div>
                    <div class="attribute-signature">
            <p>Iguana IT - <a href="http://www.iguanait.com/" title="http://www.iguanait.com">http://www.iguanait.com</a></p>
            </div>
        
                                </td>
    <td class="buttons">
    <div class="button">
        <a href="#main"><img src="../../../../extension/ezprojects2007/design/ezprojects2007/images/button-move_up.gif" height="16" width="16" alt="Up" title="Jump to first message" /></a>
    </div>
    </td>
</tr>    




<tr class="bgdark" id="msg23343">
    
    <td class="info">
        <p class="author"><a href="../../../users/community/steven_e_bailey.html">Steven E Bailey</a></p>


                    <div class="attribute-image">

    
        
    
    <img src="../../../../var/plain_site/storage/images/users/community/steven_e_bailey/32288-148-eng-GB/steven_e_bailey_small.jpg" width="100" height="100"  border="0" alt="" title="" />
    
    
    </div>
        
        <p class="membersince">Member since:<br />27 April 2006</p>
        <p class="posts">Posts: 54</p>
    </td>

    
    <td class="message">
                    <form method="post" action="http://projects.ez.no/index.php/content/action">
                <div class="object-right">
                                                </div>
           </form>
       
        <p class="date">Tuesday 16 February 2010 5:47:00 pm</p>

        <div class="attribute-long">What I'm seeing there looks o.k. to me.  That should be appearing as an attachment.<br />
<br />
There could be reasons (that I can think of) why it isn't - like there is an extra plain/text header somewhere or the multipart_boundary is broken somehow.<br />
<br />
Can you maybe Forward me the mail? to <a href='mailto:info@contactivity.com'>info@contactivity.com</a><br />
<br />
If you can save it as a .eml file and send that as an attachment that would be even better.<br />
<br />
That way I can maybe see what is going on with the headers.<br />

</div>
                    <div class="attribute-signature">
            <p><a href="http://www.leidentech.com/" title="http://www.leidentech.com">http://www.leidentech.com</a><br />
eZPublishLegacy - eZ Publish Release Mirror | <a href="http://ezpublishlegacy.com/" title="http://ezpublishlegacy.com">http://ezpublishlegacy.com</a></p>
            </div>
        
                                </td>
    <td class="buttons">
    <div class="button">
        <a href="#main"><img src="../../../../extension/ezprojects2007/design/ezprojects2007/images/button-move_up.gif" height="16" width="16" alt="Up" title="Jump to first message" /></a>
    </div>
    </td>
</tr>
</table>

</div>



 

            <p>You need to be <a href="../../../user/login.html">logged in</a> to post messages in the forums. New users may <a href="http://auth.ez.no/user/register">register here</a>.</p>
    
</div>
</div>
</div>



<!-- Main area content: END -->

</div>
</div>
<!-- Main area: END -->
<hr class="hide" />

<!-- Footer area: START -->
<div id="page-width6">
<div id="footer">

<address>Powered by <a href="http://ez.no/ezpublish" title="eZ Publish Content Management System">eZ Publish&reg; Content Management System.</a></address>
<address>Copyright &copy; 2007-2011 eZ Systems AS (except where otherwise noted). All rights reserved.</address>
</div>
</div>
<!-- Footer area: END -->

</div>
<!-- Complete page area: END -->

<!-- BEGIN GA tracker script -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-24601020-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- END GA tracker script -->





</body>

<!-- Mirrored from projects.ez.no/index.php/enhancedezbinaryfile/forum/general/messed_up_headers_causes_wrong_parsing by HTTrack Website Copier/3.x [XR&CO'2013], Sun, 05 Feb 2017 22:04:33 GMT -->
</html>
