<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>eZ Projects / ezvlogin</title>
    <link>http://projects.ez.no/</link>
    <description></description>
    <language>en-GB</language>
    <managingEditor>community@ez.no (Administrator User)</managingEditor>
    <pubDate>Sun, 05 Feb 2017 13:56:25 +0000</pubDate>
    <lastBuildDate>Sun, 05 Feb 2017 13:56:24 +0000</lastBuildDate>
    <generator>eZ Components Feed dev (http://ezcomponents.org/docs/tutorials/Feed)</generator>
    <docs>http://www.rssboard.org/rss-specification</docs>
    <atom:link href="http://projects.ez.no/rss/feed/11848" rel="self" type="application/rss+xml"/>
    <item>
      <title>Re: Is this plugin still relevant?</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/is_this_plugin_still_relevant/re_is_this_plugin_still_relevant</link>
      <description>Well, reason for inactivity is that it works as intended.&#13;
&#13;
As for if it is needed or not, that depends on your setup and your needs.&#13;
As for the 'is_logged_in' cookie, no. 4.4 only creates a session cookie when it is needed so you should instead avoid caching the request if there are cookies (esp session cookies) in the request. In other words closer to how all proxies / reverse proxies works out of the box.&#13;
&#13;
&#13;
For some info on the other features ezvlogin supports, look here:&#13;
http://websvn.projects.ez.no/wsvn/ezvlogin/trunk/ezvlogin/settings/vlogin.ini&#13;
&#13;
</description>
      <author>community@ez.no (André R)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/is_this_plugin_still_relevant/re_is_this_plugin_still_relevant</guid>
      <pubDate>Tue, 23 Nov 2010 12:04:42 +0000</pubDate>
    </item>
    <item>
      <title>Is this plugin still relevant?</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/is_this_plugin_still_relevant</link>
      <description>We've been using Varnish with our site mostly successfully without this plugin.  Our members must log in to comment and to see Member-only pages, and for customization of their view.&#13;
&#13;
On eZ Publish 4.2 things mostly worked, but occasionally we had people get logged out by the system, and they then could not log in and stay logged in.&#13;
&#13;
When we upgraded to eZ Publish 4.4 recently, this problem became universal-- no one could log in and stay logged in.  The subsequent page load would kick them back out.&#13;
&#13;
Is this something this plugin would help with?  Is this plugin still relevant, given that there doesn't appear to be much activity recently?&#13;
&#13;
Thanks very much!</description>
      <author>community@ez.no (A Fowler)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/is_this_plugin_still_relevant</guid>
      <pubDate>Mon, 22 Nov 2010 17:41:57 +0000</pubDate>
    </item>
    <item>
      <title>ezvlogin rev. 37 by André R</title>
      <link>http://projects.ez.no/ezvlogin/subversion/37</link>
      <description>- removed duplicate vlogin.ini file</description>
      <author>community@ez.no (Administrator User)</author>
      <guid>http://projects.ez.no/ezvlogin/subversion/37</guid>
      <pubDate>Thu, 30 Sep 2010 20:10:25 +0000</pubDate>
    </item>
    <item>
      <title>ezvlogin rev. 36 by André R</title>
      <link>http://projects.ez.no/ezvlogin/subversion/36</link>
      <description>- Rename base ini files to *.ini  so settings/view is able to list it in drop down</description>
      <author>community@ez.no (Administrator User)</author>
      <guid>http://projects.ez.no/ezvlogin/subversion/36</guid>
      <pubDate>Mon, 05 Jul 2010 09:10:20 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers29</link>
      <description>Hi all,&#13;
&#13;
@Jérôme is there any progress in the "official" .vcl file for ez Publish, you mentioned at Friday 20 February 2009 10:21:27 am?&#13;
&#13;
This would be a nice thing,&#13;
&#13;
&#13;
Greetings, ekke</description>
      <author>community@ez.no (Ekkehard Dörre)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers29</guid>
      <pubDate>Wed, 11 Nov 2009 18:04:59 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers28</link>
      <description>Hi there. We'll gonna implement varnish for one of our projects. i will try all your suggestions about .vcl file. Anyway, Jérome was talking about an 'official ez publish varnish configuration'.  how is it? Should i try start with this one?&#13;
&#13;
http://svn.projects.ez.no/ezvlogin/tags/ezvlogin-1.1/doc/example.vcl&#13;
&#13;
and then add your suggestions?&#13;
&#13;
Thanks in advanced. &#13;
&#13;
Best regards.</description>
      <author>community@ez.no (Carlos Revillo)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers28</guid>
      <pubDate>Mon, 07 Sep 2009 22:55:28 +0000</pubDate>
    </item>
    <item>
      <title>ezvlogin rev. 35 by André R</title>
      <link>http://projects.ez.no/ezvlogin/subversion/35</link>
      <description>- Implemented: Add cacheable vlogin/profile view for user profiles</description>
      <author>community@ez.no (Administrator User)</author>
      <guid>http://projects.ez.no/ezvlogin/subversion/35</guid>
      <pubDate>Sat, 22 Aug 2009 14:50:13 +0000</pubDate>
    </item>
    <item>
      <title>ezvlogin rev. 34 by André R</title>
      <link>http://projects.ez.no/ezvlogin/subversion/34</link>
      <description>Reverted some of changes from Rev. 32/33 (new view comming instead for profile)</description>
      <author>community@ez.no (Administrator User)</author>
      <guid>http://projects.ez.no/ezvlogin/subversion/34</guid>
      <pubDate>Sat, 22 Aug 2009 13:20:13 +0000</pubDate>
    </item>
    <item>
      <title>ezvlogin rev. 33 by André R</title>
      <link>http://projects.ez.no/ezvlogin/subversion/33</link>
      <description>Sync with 4.2 (added public_profile variable)</description>
      <author>community@ez.no (Administrator User)</author>
      <guid>http://projects.ez.no/ezvlogin/subversion/33</guid>
      <pubDate>Sat, 22 Aug 2009 11:35:14 +0000</pubDate>
    </item>
    <item>
      <title>ezvlogin rev. 32 by André R</title>
      <link>http://projects.ez.no/ezvlogin/subversion/32</link>
      <description>Sync with 4.2 (added public_profile variable)</description>
      <author>community@ez.no (Administrator User)</author>
      <guid>http://projects.ez.no/ezvlogin/subversion/32</guid>
      <pubDate>Sat, 22 Aug 2009 11:35:13 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers27</link>
      <description>Oh, I should add a big thank you to everyone that's posted stuff about this varnish stuff + I have to say, it's well worth it in the end!</description>
      <author>community@ez.no (STEVO +)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers27</guid>
      <pubDate>Wed, 22 Jul 2009 21:41:23 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers26</link>
      <description>Hi Norman,&#13;
&#13;
Thanks, i was pretty sure I tried that (but in vcl_fetch) but perhaps I forgot the pragma. It's easy to run around in circles with this stuff eh?&#13;
&#13;
After 2 days of blindly hacking around I think I've got everything working as I want. I have anonymous users cached, basic users cached with a different hash and advanced users passed right through.&#13;
&#13;
I've also patched the kernel with a little helper function to set a has_user_data cookie if there's anything in the basket or wishlist or particular user/preferences set. I'll have to upload an extension.</description>
      <author>community@ez.no (STEVO +)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers26</guid>
      <pubDate>Wed, 22 Jul 2009 21:38:10 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers25</link>
      <description>Hi Stevo,&#13;
&#13;
you could also drop the header information from ez within the vcl so the client's browser dosen't cache the html requests:&#13;
&#13;
&lt;code&gt;&#13;
sub vcl_hit&#13;
{&#13;
    if (!obj.cacheable)&#13;
    {&#13;
       pass;&#13;
    }&#13;
   &#13;
    if (req.url ~ "\.(gif|jpg|jpeg|swf|css|js|flv|mp3|mp4|pdf|ico)$")&#13;
    {&#13;
        deliver;   &#13;
    }&#13;
    &#13;
    set obj.http.Cache-Control = "no-cache, must-revalidate";&#13;
    set obj.http.Pragma = "no-cache";&#13;
&#13;
    deliver;&#13;
}&#13;
&#13;
&lt;/code&gt;&#13;
</description>
      <author>community@ez.no (Norman Leutner)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers25</guid>
      <pubDate>Wed, 22 Jul 2009 16:31:48 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers24</link>
      <description>Hi,&#13;
&#13;
I've been trying to follow Norman's method for forcing the browser to request again after the user logs in/out.&#13;
&#13;
For me, it didn't work when the user logs out: The browser seems to make the request with "If-Modified-Since" and so varnish returns a 304 Not Modified and the browser uses it's latest cached file which - the logged in version.&#13;
&#13;
I may well have missed something, but I've solved the problem for me by adding:&#13;
&#13;
&lt;code&gt;set req.http.If-Modified-Since = "Mon, 26 Jul 1997 05:00:00 GMT";&lt;/code&gt;&#13;
&#13;
to the bottom of sub vcl_recv. Varnish will then lookup + return it's non-logged in cached version + all is well.</description>
      <author>community@ez.no (STEVO +)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers24</guid>
      <pubDate>Wed, 22 Jul 2009 15:39:26 +0000</pubDate>
    </item>
    <item>
      <title>ezvlogin rev. 31 by André R</title>
      <link>http://projects.ez.no/ezvlogin/subversion/31</link>
      <description>fix  "?</description>
      <author>community@ez.no (Administrator User)</author>
      <guid>http://projects.ez.no/ezvlogin/subversion/31</guid>
      <pubDate>Thu, 30 Apr 2009 14:35:10 +0000</pubDate>
    </item>
    <item>
      <title>ezvlogin rev. 30 by André R</title>
      <link>http://projects.ez.no/ezvlogin/subversion/30</link>
      <description>Correctly delete cookies set by remote server to be deleted instead of setting it with value 'deleted'.</description>
      <author>community@ez.no (Administrator User)</author>
      <guid>http://projects.ez.no/ezvlogin/subversion/30</guid>
      <pubDate>Thu, 30 Apr 2009 13:30:08 +0000</pubDate>
    </item>
    <item>
      <title>ezvlogin rev. 29 by André R</title>
      <link>http://projects.ez.no/ezvlogin/subversion/29</link>
      <description>Allow session id to be reset from other server</description>
      <author>community@ez.no (Administrator User)</author>
      <guid>http://projects.ez.no/ezvlogin/subversion/29</guid>
      <pubDate>Thu, 30 Apr 2009 08:25:10 +0000</pubDate>
    </item>
    <item>
      <title>ezvlogin rev. 28 by André R</title>
      <link>http://projects.ez.no/ezvlogin/subversion/28</link>
      <description>+ Synced vlogin with user module in 4.1, merging #14301 and #9275 and updated copyright headers</description>
      <author>community@ez.no (Administrator User)</author>
      <guid>http://projects.ez.no/ezvlogin/subversion/28</guid>
      <pubDate>Tue, 28 Apr 2009 09:05:08 +0000</pubDate>
    </item>
    <item>
      <title>ezvlogin rev. 27 by André R</title>
      <link>http://projects.ez.no/ezvlogin/subversion/27</link>
      <description>* Added support for inter server sso (when several servers run on same domain behind load balancer)
#changed logic to only do sso call if part of sso group (list)</description>
      <author>community@ez.no (Administrator User)</author>
      <guid>http://projects.ez.no/ezvlogin/subversion/27</guid>
      <pubDate>Mon, 27 Apr 2009 16:10:13 +0000</pubDate>
    </item>
    <item>
      <title>ezvlogin rev. 26 by André R</title>
      <link>http://projects.ez.no/ezvlogin/subversion/26</link>
      <description>* Added support for inter server sso (when several servers run on same domain behind load balancer)
* Bumped version to 1.2</description>
      <author>community@ez.no (Administrator User)</author>
      <guid>http://projects.ez.no/ezvlogin/subversion/26</guid>
      <pubDate>Mon, 27 Apr 2009 16:05:07 +0000</pubDate>
    </item>
    <item>
      <title>ezvlogin rev. 25 by André R</title>
      <link>http://projects.ez.no/ezvlogin/subversion/25</link>
      <description>give access denied instead of object not available if usere is annonymus and no id is given</description>
      <author>community@ez.no (Administrator User)</author>
      <guid>http://projects.ez.no/ezvlogin/subversion/25</guid>
      <pubDate>Sun, 26 Apr 2009 12:30:07 +0000</pubDate>
    </item>
    <item>
      <title>ezvlogin rev. 24 by André R</title>
      <link>http://projects.ez.no/ezvlogin/subversion/24</link>
      <description>+ Fixed redirection to user/register in vlogin/login</description>
      <author>community@ez.no (Administrator User)</author>
      <guid>http://projects.ez.no/ezvlogin/subversion/24</guid>
      <pubDate>Sun, 26 Apr 2009 12:20:07 +0000</pubDate>
    </item>
    <item>
      <title>ezvlogin rev. 23 by André R</title>
      <link>http://projects.ez.no/ezvlogin/subversion/23</link>
      <description>Added siteaccess to template parameters in case needed in view</description>
      <author>community@ez.no (Administrator User)</author>
      <guid>http://projects.ez.no/ezvlogin/subversion/23</guid>
      <pubDate>Fri, 24 Apr 2009 13:35:10 +0000</pubDate>
    </item>
    <item>
      <title>ezvlogin rev. 22 by André R</title>
      <link>http://projects.ez.no/ezvlogin/subversion/22</link>
      <description>+ Added support for view_parameters in vlogin/edit</description>
      <author>community@ez.no (Administrator User)</author>
      <guid>http://projects.ez.no/ezvlogin/subversion/22</guid>
      <pubDate>Thu, 26 Mar 2009 17:55:08 +0000</pubDate>
    </item>
    <item>
      <title>Re: User Login - Logout redirection</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/user_login_logout_redirection/re_user_login_logout_redirection</link>
      <description>approach 1 would be best, just make sure you also set the get parameter in the user/login template so it is not lost when you have to re type user / password.&#13;
&#13;
And Varnish must not be setup to strip get parameters from cache object (if you cache the user/login page).</description>
      <author>community@ez.no (André R)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/user_login_logout_redirection/re_user_login_logout_redirection</guid>
      <pubDate>Thu, 19 Mar 2009 10:54:48 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers23</link>
      <description>I can confirmed that you should not set Expires headers, as they will cause browsers to cache pages as well.&#13;
&#13;
This is some of the settings we use on a site (with squid, but in this regard they behave the same, only Varnish is much better at handling cookies for login status with vcl files like the ones above):&#13;
&lt;code&gt;&#13;
[HTTPHeaderSettings]&#13;
CustomHeader=enabled&#13;
# new setting as of 4.0.2 and 4.1 (#014130)&#13;
# Not really needed with a decent vcl setup, but doesn't hurt&#13;
OnlyForAnonymous=enabled&#13;
Pragma[]&#13;
Pragma[/]=cache&#13;
# Needed since httpheader code does not set headers for other&#13;
# modules then content view unless specific asked for it &#13;
Pragma[/user/login]=cache&#13;
# How long Squid should cache &#13;
Cache-Control[]&#13;
Cache-Control[/]=cache, s-maxage=600&#13;
Cache-Control[/user/login]=cache, s-maxage=600&#13;
&lt;/code&gt;&#13;
&#13;
I just post it for reference, it works but the "public, must-revalidate, max-age" setting from Norman is probably better.</description>
      <author>community@ez.no (André R)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers23</guid>
      <pubDate>Thu, 19 Mar 2009 10:48:41 +0000</pubDate>
    </item>
    <item>
      <title>ezvlogin rev. 21 by André R</title>
      <link>http://projects.ez.no/ezvlogin/subversion/21</link>
      <description>improve ini comment for CookieName</description>
      <author>community@ez.no (Administrator User)</author>
      <guid>http://projects.ez.no/ezvlogin/subversion/21</guid>
      <pubDate>Tue, 10 Mar 2009 10:00:07 +0000</pubDate>
    </item>
    <item>
      <title>User Login - Logout redirection</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/user_login_logout_redirection</link>
      <description>Hi all,&#13;
&#13;
This is a great extension but once I found it I wonder if it will handle my endless karma : Redirection. All proxy sites have problems with the LastAccesUri Session variable, because many templates are cached on the proxy and once one user login, this session variable will be kept on proxy cache so all users from here on will be redirected to the cache session after login variable.&#13;
&#13;
I have tried many things but they don't have the desired results:&#13;
&#13;
1. Sending redirect url to the user/login module based on GET parameters&#13;
    For example: user/login?redirect=yourredirect&#13;
    But if you make a mistake in login user or password the GET parameters will be lost on redirection. Of course template ttl=0 to user/login and the cache-control=no-cache on the headers&#13;
&#13;
2. Setting a new session variable based on ajax changing.&#13;
    Once the page loads I send the current URL to an ajax module to set a new session var &#13;
iable and I read this session variable on the /user/login template. Of course template ttl=0 to user/login and the cache-control=no-cache on the headers.&#13;
&#13;
   The problem with this one is that is works randomly...I dont know why please suggestions.&#13;
&#13;
Any help is accepted...&#13;
&#13;
&#13;
</description>
      <author>community@ez.no (Felipe Jaramillo)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/user_login_logout_redirection</guid>
      <pubDate>Fri, 06 Mar 2009 23:40:04 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers22</link>
      <description>Hello Norman,&#13;
&#13;
thanks for the feedback.&#13;
&#13;
I am discussing with Paul on how we could provide some kind of an "official" .vcl file for eZ Publish.&#13;
&#13;
Once we are done with this I think Paul will inform the community.&#13;
&#13;
Cheers :)</description>
      <author>community@ez.no (Jérôme Renard)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers22</guid>
      <pubDate>Fri, 20 Feb 2009 09:21:27 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers21</link>
      <description>Due to some trouble with other installations, I changed &#13;
&#13;
&lt;code&gt;&#13;
  if (req.request == "POST")&#13;
  {&#13;
      pipe;&#13;
  }&#13;
&lt;/code&gt;&#13;
&#13;
to &#13;
&#13;
&lt;code&gt;&#13;
  if (req.request == "POST")&#13;
  {&#13;
      pass;&#13;
  }&#13;
&lt;/code&gt;&#13;
&#13;
which means that only the post request itself is passed.&#13;
</description>
      <author>community@ez.no (Norman Leutner)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers21</guid>
      <pubDate>Fri, 20 Feb 2009 09:20:21 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers20</link>
      <description>Removing that part works fine.</description>
      <author>community@ez.no (Norman Leutner)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers20</guid>
      <pubDate>Fri, 20 Feb 2009 08:21:50 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers19</link>
      <description>Hi Jerome,&#13;
&#13;
I found out that &#13;
&#13;
&lt;code&gt;&#13;
   if (req.request == "POST")&#13;
   {&#13;
       pipe;&#13;
   }&#13;
&lt;/code&gt;&#13;
&#13;
causes some trouble, as soon as the client sends a post, he'll enter the pipe mode which means that alls requests are passed to the backend as long as the connection is available.&#13;
&#13;
This happens for exaple when using ajax functions like "update viewcount".</description>
      <author>community@ez.no (Norman Leutner)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers19</guid>
      <pubDate>Fri, 20 Feb 2009 08:18:37 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers18</link>
      <description>I've tested a bit around and the .vcl seems to be fine now, &#13;
when working without the expires header:&#13;
&#13;
&lt;code&gt;&#13;
sub vcl_recv&#13;
{&#13;
&#13;
   if (req.request == "POST")&#13;
   {&#13;
       pipe;&#13;
   }&#13;
 &#13;
   if(req.http.Cookie ~ "^is_logged_in=true.*$")&#13;
   {&#13;
       pass;&#13;
   }&#13;
 &#13;
   if (req.request == "GET")&#13;
   {&#13;
       lookup;&#13;
   }&#13;
 &#13;
   if (req.url ~ "\.(gif|jpg|jpeg|swf|css|js|flv|mp3|mp4|pdf|ico)$")&#13;
   {&#13;
       lookup;&#13;
   }&#13;
 &#13;
   /* Nirvana */&#13;
   remove req.http.cookie;&#13;
}&#13;
&#13;
 &#13;
sub vcl_fetch&#13;
{&#13;
   /**&#13;
    *  Works with eZ Publish 3.*, 4.0.* with eZ Vlogin&#13;
    */&#13;
   if (obj.http.Set-Cookie ~ "^eZSESSID.*=.*$")&#13;
   {&#13;
       set obj.http.X-Cookie = "Cookie removed";&#13;
       remove obj.http.Set-Cookie;&#13;
   }&#13;
     &#13;
}&#13;
&#13;
sub vcl_hit&#13;
{&#13;
   if (!obj.cacheable)&#13;
   {&#13;
       pass;&#13;
   }&#13;
&#13;
   set obj.http.X-Cache = "Cache-Hit";&#13;
   deliver;&#13;
}&#13;
&lt;/code&gt;</description>
      <author>community@ez.no (Norman Leutner)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers18</guid>
      <pubDate>Thu, 19 Feb 2009 12:20:13 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers17</link>
      <description>Should we talk about skype ?</description>
      <author>community@ez.no (Norman Leutner)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers17</guid>
      <pubDate>Thu, 19 Feb 2009 12:07:18 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers16</link>
      <description>&lt;code&gt;&#13;
 if (obj.http.Set-Cookie ~ "^eZSESSID=.*$")&#13;
&lt;/code&gt;&#13;
&#13;
should be&#13;
&#13;
&lt;code&gt;&#13;
   if (obj.http.Set-Cookie ~ "^eZSESSID.*=.*$")&#13;
&lt;/code&gt;&#13;
</description>
      <author>community@ez.no (Norman Leutner)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers16</guid>
      <pubDate>Thu, 19 Feb 2009 11:59:18 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers15</link>
      <description>Well it seem that removing the Expires field helped.&#13;
&#13;
This is weird though, good to know anyway :)</description>
      <author>community@ez.no (Jérôme Renard)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers15</guid>
      <pubDate>Thu, 19 Feb 2009 11:58:19 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers14</link>
      <description>Take a look at http://www.all2e.com</description>
      <author>community@ez.no (Norman Leutner)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers14</guid>
      <pubDate>Thu, 19 Feb 2009 11:48:37 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers13</link>
      <description>This should not change things as Cache-Control should override Expires when both are set : &#13;
&#13;
http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.21&#13;
&lt;code&gt;&#13;
      Note: if a response includes a Cache-Control field with the max-&#13;
      age directive (see section 14.9.3), that directive overrides the&#13;
      Expires field.&#13;
&lt;/code&gt;&#13;
&#13;
I will test without Expires anyway, we never know ;)</description>
      <author>community@ez.no (Jérôme Renard)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers13</guid>
      <pubDate>Thu, 19 Feb 2009 11:44:37 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers12</link>
      <description>Try removing the Expires header</description>
      <author>community@ez.no (Norman Leutner)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers12</guid>
      <pubDate>Thu, 19 Feb 2009 11:36:13 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers11</link>
      <description>Does not work either with your .vcl and mine, I tried with the following headers : &#13;
&#13;
&lt;code&gt;&#13;
Cache-Control[]&#13;
Cache-Control[/]=public, must-revalidate, max-age=200&#13;
&#13;
Pragma[]&#13;
Pragma[/]=&#13;
&#13;
Expires[]&#13;
Expires[/]=+200&#13;
&lt;/code&gt;</description>
      <author>community@ez.no (Jérôme Renard)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers11</guid>
      <pubDate>Thu, 19 Feb 2009 11:30:34 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers10</link>
      <description>Another thing I modified is the behavior of ETags within Apache.&#13;
I removed them all...&#13;
&#13;
&lt;code&gt;&#13;
Header unset ETag&#13;
FileETag None&#13;
&lt;/code&gt;&#13;
&#13;
</description>
      <author>community@ez.no (Norman Leutner)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers10</guid>
      <pubDate>Thu, 19 Feb 2009 11:29:50 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers9</link>
      <description>Ha ok you use must-revalidate, not me.&#13;
Will add right away.</description>
      <author>community@ez.no (Jérôme Renard)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers9</guid>
      <pubDate>Thu, 19 Feb 2009 11:17:54 +0000</pubDate>
    </item>
    <item>
      <title>ezvlogin rev. 20 by Jérôme Renard</title>
      <link>http://projects.ez.no/ezvlogin/subversion/20</link>
      <description>:retab</description>
      <author>community@ez.no (Administrator User)</author>
      <guid>http://projects.ez.no/ezvlogin/subversion/20</guid>
      <pubDate>Thu, 19 Feb 2009 10:40:09 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers8</link>
      <description>How are your headers looking like?&#13;
&#13;
Currently I use:&#13;
&lt;code&gt;&#13;
[HTTPHeaderSettings]&#13;
CustomHeader=enabled&#13;
HeaderList[]=Cache-Control&#13;
HeaderList[]=Pragma&#13;
Cache-Control[/]=public, must-revalidate, max-age=10800&#13;
Pragma[/]=&#13;
&lt;/code&gt;&#13;
&#13;
which works fine.</description>
      <author>community@ez.no (Norman Leutner)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers8</guid>
      <pubDate>Thu, 19 Feb 2009 10:25:20 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers7</link>
      <description>Actually I still got a problem with the issue described in your first post. My test was a false positive :/. I tried with your configuration file and mine, same problem in both cases.&#13;
&#13;
But I am thinking about a potential workaround for this.&#13;
&#13;
To sum up the issue is the following : &#13;
&#13;
- You are anonymous, you get the page from Varnish or your local cache.&#13;
- You log in and are redirected to the previously visited page and tadahh you get your local copy, which is of course not what you want, you want a fresh page, like if there is no-cache, no-store no-xxxx.&#13;
&#13;
The idea is the following : &#13;
Since, in ezvlogin we control the way users are authenticated, how about adding a specific marker to Varnish to say "Hey I just loged in send no-cache|store|whatever because I want&#13;
a fresh copy, and not my local one".&#13;
&#13;
This could be a cookie or a specific HTTP header. I would not like adding yet another cookie because we already have too much of them on the eZ Publish' plate... But I would prefer sending a specific HTTP header that Varnish could understand, something like : &#13;
Just-Logged-in=yes, and if Varnish gets this header it returns no-cachexxxx and remove this header after that of course to keep things clean and clear.&#13;
&#13;
What do you think about this ?&#13;
&#13;
I will write a patch for ezvlogin anyway and see what happens, if it work then I will commit it to trunk.&#13;
&#13;
&lt;code&gt;&#13;
[...]also the cookie "is_logged_in" cookie should be standard.&#13;
&lt;/code&gt;&#13;
&#13;
As of 4.1 you wil get such a cookie, is_logged_in=true when logged in and is_logged_in=delete for anonymous users.</description>
      <author>community@ez.no (Jérôme Renard)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers7</guid>
      <pubDate>Thu, 19 Feb 2009 10:15:31 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers6</link>
      <description>The .vcl seems fine. I'll give it a try later today and see what happens.&#13;
&#13;
I agree with you about the standard which should be supported by eZ, &#13;
also the cookie "is_logged_in" cookie should be standard.&#13;
&#13;
Additionally we need to have a cookie like "has_user_data".&#13;
For example when a anonymous user adds something to the basket or to the whishlist.&#13;
&#13;
This could easily done by adding a few lines to the modules.&#13;
&#13;
Currently I hacked the basket.php like:&#13;
&lt;code&gt;&#13;
// Set eZVLogin cookies&#13;
$user   = eZUser::instance();&#13;
eZVLoginHelper::setUserCookie( $user, $user-&gt;attribute('contentobject')-&gt;attribute('name') );&#13;
&lt;/code&gt; </description>
      <author>community@ez.no (Norman Leutner)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers6</guid>
      <pubDate>Thu, 19 Feb 2009 09:49:27 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers5</link>
      <description>You were right for the remove req.http.cookie; at the end of vcl_recv, it seems to work fine.&#13;
&#13;
I finally came up with the following configuration, which is a bit different than yours but it seems to work. We (eZ) should really provide "official" Varnish configuration files....&#13;
&#13;
&lt;code&gt;&#13;
backend default&#13;
{&#13;
	set backend.host = "127.0.0.1" ;&#13;
	set backend.port = "8080" ;&#13;
}&#13;
&#13;
sub vcl_recv&#13;
{&#13;
    set req.backend = default;&#13;
&#13;
    if (req.request == "POST")&#13;
    {&#13;
        pipe;&#13;
    }&#13;
&#13;
    if(req.http.Cookie ~ "^is_logged_in=true.*$")&#13;
    {&#13;
        pass;&#13;
    }&#13;
&#13;
    if (req.request == "GET")&#13;
    {&#13;
        lookup;&#13;
    }&#13;
&#13;
    if (req.url ~ "\.(gif|jpg|jpeg|swf|css|js|flv|mp3|mp4|pdf|ico)$")&#13;
    {&#13;
        lookup;&#13;
    }&#13;
&#13;
    /* Nirvana */&#13;
    remove req.http.cookie;&#13;
}&#13;
&#13;
sub vcl_fetch&#13;
{&#13;
    /**&#13;
     * Should Works with eZ Publish 3.*, 4.0.* with eZ Vlogin&#13;
     */&#13;
    //if (obj.http.Set-Cookie ~ "^eZSESSID=.*$")&#13;
    /**&#13;
     * Works with eZ Publish trunk only&#13;
     */&#13;
    if (obj.http.Set-Cookie ~ "^is_logged_in=deleted.*$")&#13;
    {&#13;
        remove obj.http.Set-Cookie;&#13;
    }&#13;
}&#13;
&#13;
&lt;/code&gt;&#13;
&#13;
:)</description>
      <author>community@ez.no (Jérôme Renard)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers5</guid>
      <pubDate>Thu, 19 Feb 2009 09:24:13 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers4</link>
      <description>This is what I currently have:&#13;
&#13;
&lt;code&gt;&#13;
sub vcl_recv {&#13;
&#13;
      # normalize encoding&#13;
      if (req.http.Accept-Encoding){&#13;
       if (req.http.Accept-Encoding ~ "gzip"){&#13;
          set req.http.Accept-Encoding = "gzip";&#13;
       }&#13;
       elseif (req.http.Accept-Encoding ~ "deflate" ) {&#13;
          set req.http.Accept-Encoding = "deflate";&#13;
       }&#13;
       else{&#13;
          remove req.http.Accept-Encoding;&#13;
       }&#13;
      }&#13;
&#13;
     if (req.url ~ "\.(js|css|jpg|png|gif|mp3|swf|flv|xml|html|ico)$"){  &#13;
        remove req.http.cookie;  &#13;
     } &#13;
&#13;
     # pass the request if Cookie from vlogin is present&#13;
     if (req.http.Cookie & req.http.Cookie ~ "is_logged_in" ) {
         pass;&#13;
     } &#13;
&#13;
     if (req.request != "GET" & req.request != "HEAD") {
         pipe;&#13;
     }&#13;
 &#13;
     if (req.http.Expect) {&#13;
         pipe;&#13;
     }&#13;
 &#13;
     if (req.http.Authenticate) {&#13;
         pass;&#13;
     }&#13;
 &#13;
     if (req.http.Cache-Control ~ "no-cache") {&#13;
         pass;&#13;
     }&#13;
&#13;
     # Cache all other objects which use cookies (overwrite default).&#13;
     # throw away all other cookies and lookup&#13;
     remove req.http.cookie;&#13;
     lookup;&#13;
}&#13;
 &#13;
sub vcl_hit {&#13;
 &#13;
     if (!obj.cacheable) {&#13;
         pass;&#13;
     }&#13;
 &#13;
    deliver;&#13;
}&#13;
 &#13;
sub vcl_fetch {&#13;
 &#13;
     if (!obj.cacheable) {&#13;
        pass;&#13;
     }&#13;
 &#13;
     # remove cookie information if the user isn't logged in&#13;
     if (obj.http.Set-Cookie & (!obj.http.Set-Cookie == "is_logged_in")) {
       remove obj.http.Set-Cookie; &#13;
     }&#13;
    &#13;
     if (  obj.http.Pragma        ~ "no-cache"&#13;
        || obj.http.Cache-Control ~ "no-cache" &#13;
        || obj.http.Cache-Control ~ "private") {&#13;
             pass;&#13;
     }&#13;
&#13;
     if (obj.ttl &lt; 3600s){&#13;
             set obj.ttl = 3600s;&#13;
     }&#13;
&#13;
     deliver;&#13;
}&#13;
&lt;/code&gt;&#13;
&#13;
Mainly it throws away any cookie information. &#13;
Additionaly I'm normalizing the encoding for all browsers.</description>
      <author>community@ez.no (Norman Leutner)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers4</guid>
      <pubDate>Thu, 19 Feb 2009 08:46:09 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers3</link>
      <description>Hello Norman,&#13;
&#13;
I wrote a very similar .vcl file yesterday evening, however it does not seem to work for me.&#13;
&#13;
Here is what I got so far.&#13;
As you will notice there are a few debugging stuff but the concept is there anyway&#13;
&#13;
&lt;code&gt;&#13;
sub vcl_recv&#13;
{&#13;
    set req.backend = default;&#13;
&#13;
    /***************************************************/&#13;
    /* Never cache pages with POST parameters          */&#13;
    /* Typical use case : /user/login or /usr/register */&#13;
    /* You do not want to get those pages cached       */&#13;
    /***************************************************/&#13;
    if (req.request == "POST")&#13;
    {&#13;
        pipe;&#13;
    }&#13;
&#13;
    /******************************************************/&#13;
    /* do not use Varnish when the user is authenticated  */&#13;
    /* This configuration requires the ezvlogin extension */&#13;
    /* http://projects.ez.no/ezvlogin                     */&#13;
    /* With the default configuration for LoginSettings   */&#13;
    /* in vlogin.ini.append.php                           */&#13;
    /******************************************************/&#13;
&#13;
    //if(req.http.Cookie ~ "^is_logged_in=true.*$")&#13;
    if (req.http.Set-Cookie ~ "^is_logged_in=true.*$")&#13;
    {&#13;
        pass;&#13;
    }&#13;
    &#13;
    /********************************************************/&#13;
    /* Returns the item from the cache for any GET request  */&#13;
    /* All the configuration done in HTTPHeaderSettings in  */ &#13;
    /* eZ Publish as well as Apache's mod_expires will come */&#13;
    /* into play here                                       */&#13;
    /********************************************************/&#13;
    if (req.request == "GET")&#13;
    {&#13;
        lookup;&#13;
    }&#13;
&#13;
    /*********************************************************/&#13;
    /* We want Varnish to return binary files from its cache */&#13;
    /* all the configuration we used for mod_expires is used */&#13;
    /* in this case                                          */&#13;
    /*********************************************************/&#13;
    if (req.url ~ "\.(gif|jpg|jpeg|swf|css|js|flv|mp3|mp4|pdf|ico)$")&#13;
    {&#13;
        lookup;&#13;
    }&#13;
}&#13;
&#13;
sub vcl_fetch&#13;
{&#13;
    /**&#13;
     * Might work with eZ Publish 4.0.1 and with and without eZ Vlogin&#13;
     */&#13;
    //if (obj.http.Cookie ~ "^eZSESSID=.*$")&#13;
    /**&#13;
     * Works with eZ Publish trunk only&#13;
     */&#13;
    // WORKS !!!&#13;
    if (obj.http.Set-Cookie ~ "^is_logged_in=deleted.*$")&#13;
    {&#13;
        set obj.http.Is-Logged-In="deleted";&#13;
        // DOES NOT WORK !!&#13;
        //remove obj.http.Cookie;&#13;
        // WORKS !!!&#13;
        remove obj.http.Set-Cookie;&#13;
    }&#13;
    // WORKS !!!!&#13;
    else if (obj.http.Set-Cookie ~ "^is_logged_in=true.*$")&#13;
    {&#13;
        set obj.http.Is-Logged-In="true";&#13;
    }&#13;
    &#13;
    set obj.http.X-Cache = "Miss";&#13;
}&#13;
&#13;
sub vcl_hit&#13;
{&#13;
    if (!obj.cacheable)&#13;
    {&#13;
        pass;&#13;
    }&#13;
&#13;
    set obj.http.X-Cache = "Hit";&#13;
&#13;
    deliver;&#13;
}&#13;
&lt;/code&gt;&#13;
&#13;
I will send the correct .vcl file as soon as I get everything working fine.&#13;
&#13;
I do not know your feeling about Varnish but even though it is really powerful, it is also very easy to make mistakes without noticing it, and testing can be really difficult.</description>
      <author>community@ez.no (Jérôme Renard)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers3</guid>
      <pubDate>Thu, 19 Feb 2009 08:17:52 +0000</pubDate>
    </item>
    <item>
      <title>Re: Working with custom Headers</title>
      <link>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers2</link>
      <description>Hi Jerome,&#13;
&#13;
I've tested a bit around with some settings and found a solution that seem to work fine in most cases.&#13;
&#13;
&lt;code&gt;&#13;
[HTTPHeaderSettings]&#13;
CustomHeader=enabled&#13;
HeaderList[]=Cache-Control&#13;
HeaderList[]=Pragma&#13;
Cache-Control[/]=public, must-revalidate, max-age=10800&#13;
Pragma[/]=&#13;
&lt;/code&gt;&#13;
&#13;
with the vcl:&#13;
&#13;
&lt;code&gt;&#13;
sub vcl_recv {&#13;
&#13;
[... backend & default stuff  ...]

     # do not use Varnish when the user is authenticated
     if (req.http.Cookie && req.http.Cookie ~ "is_logged_in" ) {
         pass;&#13;
     } &#13;
&#13;
     if (req.request != "GET" & req.request != "HEAD") {
         pipe;&#13;
     }&#13;
 &#13;
     if (req.http.Expect) {&#13;
         pipe;&#13;
     }&#13;
 &#13;
     if (req.http.Authenticate) {&#13;
         pass;&#13;
     }&#13;
 &#13;
     if (req.http.Cache-Control ~ "no-cache") {&#13;
         pass;&#13;
     }&#13;
&#13;
     # Cache all other objects which use cookies (overwrite default).&#13;
     # throw away cookies all other and lookup&#13;
     remove req.http.cookie;&#13;
     lookup;&#13;
}&#13;
&#13;
sub vcl_fetch {&#13;
&#13;
     [...  default stuff  ...] &#13;
 &#13;
     if (obj.http.Set-Cookie & (!obj.http.Set-Cookie == "is_logged_in")) {
       remove obj.http.Set-Cookie; &#13;
     }&#13;
     &#13;
     [...  default stuff  ...] &#13;
&#13;
     deliver;&#13;
}&#13;
&lt;/code&gt;&#13;
&#13;
As long as the user has no "is_logged_in" Cookie, he'll get the cached version of the site.&#13;
As soon as the logs in, the requests are passed to the backend server.&#13;
&#13;
</description>
      <author>community@ez.no (Norman Leutner)</author>
      <guid>http://projects.ez.no/ezvlogin/forum/general/working_with_custom_headers/re_working_with_custom_headers2</guid>
      <pubDate>Wed, 18 Feb 2009 17:54:51 +0000</pubDate>
    </item>
  </channel>
</rss>